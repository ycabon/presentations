// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/mathUtils ../../../core/promiseUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/vec32 ../../../geometry/Polyline ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/geodesicUtils ./ProfileGenerationError".split(" "),function(N,p,O,y,D,E,P,z,u,F,r,v){function A(a,b,c){if(null==b)return G(a);const e=a.spatialReference,f=b.mode;b=b.offset??0;let d=null;switch(c.type){case "2d":d=Q(a,f,b);
break;case "3d":d=R(a,f,b,c)}return null==d?G(a):new z({hasZ:!0,hasM:!1,spatialReference:e,paths:H(a.paths,d)})}function Q({hasZ:a},b,c){switch(b){case "absolute-height":return a?([e,f,d])=>[e,f,d+c]:([e,f])=>[e,f,c];default:return null}}function R({spatialReference:a,hasZ:b},c,e,{elevationProvider:f}){switch(c){case "on-the-ground":return([d,g])=>[d,g,f?.getElevation(d,g,0,a,"ground")??0];case "absolute-height":return b?([d,g,h])=>[d,g,h+e]:([d,g])=>[d,g,e];case "relative-to-ground":return b?([d,
g,h])=>[d,g,h+(f?.getElevation(d,g,h,a,"ground")??0)+e]:([d,g])=>[d,g,(f?.getElevation(d,g,0,a,"ground")??0)+e];case "relative-to-scene":return b?([d,g,h])=>[d,g,h+(f?.getElevation(d,g,h,a,"scene")??0)+e]:([d,g])=>[d,g,(f?.getElevation(d,g,0,a,"scene")??0)+e];default:return null}}function G(a){return a.hasZ?new z({hasZ:!1,hasM:!1,spatialReference:a.spatialReference,paths:H(a.paths,([b,c])=>[b,c])}):a}function H(a,b){const c=a.length,e=Array(c);for(let f=0;f<c;++f){const d=a[f],g=d.length,h=Array(d.length);
e[f]=h;for(let k=0;k<g;++k)h[k]=b(d[k])}return e}function I(a){return null!=a&&"polyline"===a.type}function J(a,b,c,e,f){const {spatialReference:d,hasZ:g}=a,h={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:d,metersPerSR:D.getMetersPerUnitForSR(d)},k=[],q=[];let l=0;for(let m=0;m<a.paths.length;++m){const t=a.paths[m],B=[],C=[];var n=0;for(let w=1;w<t.length;++w){const K=t[w],x=e(h,t[w-1],K);for(;n<x.distance;n+=b)B.push(f(x,n)),C.push((l+n)*c);n-=x.distance;l+=x.distance;
B.push(K);C.push(l*c)}k[m]=B;q[m]=C}return{densifiedPath:new z({spatialReference:d,hasZ:g,paths:k}),distances:q}}function S(a,b,c){const {hasZ:e}=a;return J(a,b,c,T,e?U:V)}function W(a,b,c){const {hasZ:e}=a;return J(a,b,c,X,e?Y:Z)}function X(a,b,c){a.distance=0;r.inverseGeodeticSolver(a,b,c,a.spatialReference);a.from=b;a.to=c;return a}function T(a,b,c){a.from=b;a.to=c;a.distance=E.distance(c,b)*a.metersPerSR;return a}function Z({from:a,azimuth:b,spatialReference:c},e){return r.directGeodeticSolver([0,
0],a,b,e,c)}function Y({from:a,to:b,azimuth:c,distance:e,spatialReference:f},d){b=[0,0,O.lerp(a[2],b[2],d/e)];r.directGeodeticSolver(b,a,c,d,f);return b}function V({from:a,to:b,distance:c},e){return E.lerp([0,0],a,b,e/c)}function U({from:a,to:b,distance:c},e){return P.lerp([0,0,0],a,b,e/c)}function aa(a){return r.isSupported(a.spatialReference)?a:u.project(a,F.WGS84)}function L(a){return a.paths.reduce((b,c)=>b+c.length,0)}function M(a,b,c){return L(a)+Math.floor(b/c)+Math.max(0,a.paths.reduce(e=>
1+e,0)-1)}p.countPoints=L;p.densifyPath=async function(a,b,c,e,f,d,g){var h=a.spatialReference;const k=h.isGeographic||h.isWebMercator;let q=0;if(!k){var {planarLength:l}=await new Promise((m,t)=>N(["../../../geometry/geometryEngineAsync"],m,t));y.throwIfAborted(g);q=await l(a,"meters");y.throwIfAborted(g)}l=1/D.getMetersPerUnitForSR(e);const n=f.geodesicDistanceThreshold??Infinity;if(k||q>=n){await u.initializeProjection([{source:h,dest:e},{source:h,dest:F.WGS84}],g);g=aa(a);h=r.geodesicLengths([g],
"meters")[0];f=Math.max(f.samplingDistance,h/f.densificationMaxSamples);if(M(a,h,f)>d)throw new v.ProfileGenerationError(v.ProfileGenerationErrorCause.TooComplex);g=A(g,b,c);({densifiedPath:a,distances:b}=W(g,f,l))}else{await u.initializeProjection([{source:h,dest:e}],g);h=q;f=Math.max(f.samplingDistance,h/f.densificationMaxSamples);if(M(a,h,f)>d)throw new v.ProfileGenerationError(v.ProfileGenerationErrorCause.TooComplex);a=A(a,b,c);({densifiedPath:a,distances:b}=S(a,f,l));y.throwIfAborted(g)}a=u.project(a,
e);return{densifiedPath:a,pathLength:h*l,distances:b}};p.isPolyline=I;p.isValidInputPath=function(a){return I(a)&&0<a.paths.length&&a.paths.every(b=>2<=b.length)};p.toAbsoluteHeightElevation=A;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});