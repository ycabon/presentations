// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../intl ../core/arrayUtils ../core/deprecate ../core/Logger ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/decorators/subclass ../layers/support/fieldUtils ./Widget ./FeatureForm/css ./FeatureForm/featureFormUtils ./FeatureForm/FeatureFormViewModel ../chunks/componentsUtils ./support/dataUtils ./support/dateUtils ./support/globalCss ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ../intl/substitute".split(" "),
function(q,n,m,K,G,D,B,r,S,L,M,N,l,t,O,P,H,v,I,J,T,C,Q,e,E){m=class extends N{constructor(a,b){super(a,b);this._attemptFocusOnNextRender=!1;this._dateComponentMap=new Map;this._inputsWithChanges=new Set;this._listObserverNode=this._focusedFieldName=null;this._listObserver=new IntersectionObserver(c=>{c.length&&c[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document});this.groupDisplay="all";this.headingLevel=2;this.messagesTemplates=this.messagesFeature=this.messagesCommon=
this.messages=null;this.viewModel=new O;this._onShowAllRelatedRecordsClick=c=>{const {feature:d,relatedRecordCallbacks:g}=this;d&&g?.showAllRelatedRecords&&g.showAllRelatedRecords({parentFeature:d,relationshipId:c})};this._onAddRelatedRecordsClick=(c,d)=>{const {feature:g,relatedRecordCallbacks:f}=this;g&&f?.addRelatedRecord&&f.addRelatedRecord({parentFeature:g,relatedLayer:d,relationshipId:c})};this._onFormKeyDown=this._onFormKeyDown.bind(this);this._onFormSubmit=this._onFormSubmit.bind(this);this._onGroupToggle=
this._onGroupToggle.bind(this);this._onComponentBlur=this._onComponentBlur.bind(this);this._onComponentFocus=this._onComponentFocus.bind(this);this._onComponentKeyDown=this._onComponentKeyDown.bind(this);this._afterComponentCreate=this._afterComponentCreate.bind(this);this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this);this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this);this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this);
this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([B.watch(()=>this.feature,()=>{B.whenOnce(()=>!this.viewModel.updating).then(()=>{const a=this._getFocusableInput("forward");this._inputsWithChanges.clear();this._dateComponentMap.clear();this._syncGroupInputStates();this._focusedFieldName=a?.name||null;this._attemptFocusOnNextRender=!0})}),B.watch(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",a=>{if(0<a.invalid.length){const [b]=
a.invalid;a.invalid.forEach(c=>this._inputsWithChanges.add(c));this._focusedFieldName=b;this._attemptFocusOnNextRender=!0;this.scheduleRender()}}),B.watch(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange())])}loadDependencies(){return P.loadCalciteComponents({block:()=>new Promise((a,b)=>q(["../chunks/calcite-block"],a,b)),button:()=>new Promise((a,b)=>q(["../chunks/calcite-button"],a,b)),combobox:()=>new Promise((a,b)=>q(["../chunks/calcite-combobox"],
a,b)),"combobox-item":()=>new Promise((a,b)=>q(["../chunks/calcite-combobox-item"],a,b)),"combobox-item-group":()=>new Promise((a,b)=>q(["../chunks/calcite-combobox-item-group"],a,b)),icon:()=>new Promise((a,b)=>q(["../chunks/calcite-icon"],a,b)),input:()=>new Promise((a,b)=>q(["../chunks/calcite-input"],a,b)),"input-date-picker":()=>new Promise((a,b)=>q(["../chunks/calcite-input-date-picker"],a,b)),"input-message":()=>new Promise((a,b)=>q(["../chunks/calcite-input-message"],a,b)),"input-number":()=>
new Promise((a,b)=>q(["../chunks/calcite-input-number"],a,b)),"input-time-picker":()=>new Promise((a,b)=>q(["../chunks/calcite-input-time-picker"],a,b)),"input-time-zone":()=>new Promise((a,b)=>q(["../chunks/calcite-input-time-zone"],a,b)),label:()=>new Promise((a,b)=>q(["../chunks/calcite-label"],a,b)),list:()=>new Promise((a,b)=>q(["../chunks/calcite-list"],a,b)),"list-item":()=>new Promise((a,b)=>q(["../chunks/calcite-list-item"],a,b)),loader:()=>new Promise((a,b)=>q(["../chunks/calcite-loader"],
a,b)),notice:()=>new Promise((a,b)=>q(["../chunks/calcite-notice"],a,b)),"radio-button":()=>new Promise((a,b)=>q(["../chunks/calcite-radio-button"],a,b)),"radio-button-group":()=>new Promise((a,b)=>q(["../chunks/calcite-radio-button-group"],a,b)),switch:()=>new Promise((a,b)=>q(["../chunks/calcite-switch"],a,b)),"text-area":()=>new Promise((a,b)=>q(["../chunks/calcite-text-area"],a,b))})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const a=
this.relatedRecordCallbacks;return!(!a||!(a.addRelatedRecord||a.editRelatedRecord||a.showAllRelatedRecords))}get disabled(){return this.viewModel.disabled}set disabled(a){this.viewModel.disabled=a}get feature(){return this.viewModel.feature}set feature(a){this.viewModel.feature=a}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(a){this.viewModel.formTemplate=a}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",a)}get layer(){return this.viewModel.layer}set layer(a){this.viewModel.layer=
a}get map(){return this.viewModel.map}set map(a){this.viewModel.map=a}get relatedRecordCallbacks(){return this.viewModel.relatedRecordCallbacks}set relatedRecordCallbacks(a){this.viewModel.relatedRecordCallbacks=a}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(a){this.viewModel.relationshipId=a}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(a){this.viewModel.spatialReference=a}get strict(){return this.viewModel.strict}set strict(a){this.viewModel.strict=
a}get timeZone(){return this.viewModel.timeZone}set timeZone(a){this.viewModel.timeZone=a}get view(){G.deprecatedProperty(D.getLogger(this),"view",{replacement:"Use FeatureForm.map instead.",version:"4.27"});return this.viewModel.view}set view(a){G.deprecatedProperty(D.getLogger(this),"view",{replacement:"Use FeatureForm.map instead.",version:"4.27"});this.viewModel.view=a}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const {state:a}=this.viewModel;
return e.tsx("div",{class:this.classes(l.css.base,I.globalCss.widget,I.globalCss.panel)},"ready"===a?this._renderForm():null)}_renderForm(){return e.tsx("form",{class:l.css.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent())}_renderHeader(){var a=this.viewModel;if(a.formHeaderVisible){var b=null!=a.formTitle&&e.tsx(J.Heading,{key:"title",level:this.headingLevel},a.formTitle);a=null!=a.formDescription&&e.tsx("p",{class:l.css.description,
key:"description"},a.formDescription);return e.tsx("div",{class:l.css.formHeader},b,a)}}_renderContent(){const {viewModel:a}=this;return a.activeRelationshipInput?this._renderActiveRelationshipInput(a.activeRelationshipInput):a.inputs.filter(K.isSome).filter(b=>b.visible).map((b,c)=>{if(t.isGroupInput(b))return this._renderGroup(b,c);if(t.isFieldInput(b))return this._renderLabeledField(b);if(t.isRelationshipInput(b))return this._renderRelationshipInput(b)})}_renderActiveRelationshipInput(a){return this._renderRelationshipInput(a)}_renderDescriptionOrEmpty(a,
b){return null==a?null:e.tsx("div",{class:this.classes(l.css.description),id:b},a)}_renderGroup(a,b){const {disabled:c,formTemplate:d,headingLevel:g}=this,{description:f,inputs:h,label:k,open:x}=a,y=h.filter(p=>p.visible),w=this.viewModel.findField(this._focusedFieldName);b=`${this.id}_group_${b}`;return e.tsx("calcite-block",{class:this.classes(l.css.group,"sequential"===this.groupDisplay?l.css.groupSequential:null,w?.group===a?l.css.groupActive:null,c?l.css.inputDisabled:null),collapsible:!0,"data-group":a,
description:f||void 0,disabled:c,heading:`${k}`,headingLevel:d?.title?J.incrementHeadingLevel(g):g,id:b,key:b,open:x,onCalciteBlockToggle:({target:p})=>this._onGroupToggle(p,a)},y.map(p=>{if(t.isFieldInput(p))return this._renderLabeledField(p);if(t.isRelationshipInput(p))return this._renderRelationshipInput(p)}))}_getFocusableInput(a,b){var c=this.viewModel.allFieldInputs;c="forward"===a?c:c.slice().reverse();!b||t.isRelationshipInput(b)?a=0:t.isGroupInput(b)?a=(a=b.inputs.find(t.isFieldInput))?c.indexOf(a):
0:(t.isInputInGroupInput(b)&&!b.group.open?(b=b.group.inputs.filter(t.isFieldInput),a="forward"===a?b[b.length-1]:b[0]):a=b,a=c.indexOf(a)+1);for(;a<c.length;a++)if(b=c[a],b.visible&&t.isFieldInput(b))return b;return null}_renderLabeledField(a){const {dataType:b,feature:c,label:d,layer:g,required:f}=a,h={"aria-label":f?E.substitute(this.messages.requiredFieldLabel,{name:d}):d,class:l.css.label,key:`${g.id}-${c.uid}-${a.name}`},k=[e.tsx("div",{class:l.css.labelTextContent,key:"labelTextContainer"},
d,f?e.tsx("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==b?this._renderFieldInput(a):this._renderReadOnlyComponent(a),this._renderAuxiliaryText(a)];return"date"===b&&"coded-value"!==a.domain?.type?e.tsx("label",{...h},k):e.tsx("calcite-label",{...h},k)}_renderFieldInput(a){const {dataType:b,domain:c,inputType:d,name:g}=a,f=this.getCommonInputProps(a);if("coded-value"===c?.type){const h=this.viewModel.getFieldValueOptionsForField(g,this.messages.empty);
return"switch"!==d||a.hasInvalidSwitchValue?"radio-buttons"===d?this._renderRadioButtonComponents(a,h.flat(),f):this._renderComboBoxComponent(a,h,f):this._renderSwitchComponent(a,f)}return"datetime-picker"===d||"date"===b?this._renderDateComponents(a,f):"number"===b?this._renderNumberComponent(a,f):this._renderStringComponent(a,f)}_renderStringComponent(a,b){return"text-area"===a.inputType?b.readOnly?e.tsx("calcite-input",{...b,loading:a.updating,type:"textarea",onCalciteInputInput:c=>this._saveValueFromComponent(c.target)}):
e.tsx("calcite-text-area",{...b,resize:"vertical",onCalciteTextAreaInput:c=>this._saveValueFromComponent(c.target)}):e.tsx("calcite-input",{...b,loading:a.updating,type:"text",onCalciteInputInput:c=>this._saveValueFromComponent(c.target)})}_renderNumberComponent(a,b){return e.tsx("calcite-input-number",{...b,integer:M.isIntegerField(a.field),loading:a.updating,type:"number",onCalciteInputNumberInput:c=>this._saveValueFromComponent(c.target)})}_renderDateComponents(a,b){const {field:c}=a;switch(c.type){case "date":return this._renderDateFieldComponents(a,
b);case "date-only":return this._renderDateOnlyFieldComponent(a,b);case "time-only":return this._renderTimeOnlyFieldComponent(a,b);case "timestamp-offset":return this._renderTimestampOffsetFieldComponents(a,b);default:return this._renderReadOnlyComponent(a,v.getLabelForDateFieldValue(c,b.value,{timeZone:this.timeZone,...v.getIntlOptionsForField(c)}))}}_renderDateOnlyFieldComponent(a,b){const {range:c,valid:d,value:g}=a,{class:f,key:h,readOnly:k}=b,{rawMax:x,rawMin:y}=c;return e.tsx("calcite-input-date-picker",
{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!d,class:f,"data-date-part":"date","data-field-name":b["data-field-name"],key:`${h}-date-input`,max:H.isString(x)?x:void 0,min:H.isString(y)?y:void 0,numberingSystem:v.numberingSystem,onblur:w=>{this._focusedFieldName=null;this._saveValueFromDateComponent(w.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:k,value:null!=g?`${g}`:void 0,onCalciteInputDatePickerChange:w=>
this._saveValueFromDateComponent(w.target)})}_renderTimeOnlyFieldComponent(a,b){const {valid:c,value:d}=a,{class:g,key:f,readOnly:h}=b;return e.tsx("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!c,class:g,"data-date-part":"time","data-field-name":b["data-field-name"],key:`${f}-time-input`,numberingSystem:v.numberingSystem,onblur:k=>{this._focusedFieldName=null;this._saveValueFromDateComponent(k.target)},onfocus:this._onComponentFocus,
overlayPositioning:"fixed",readOnly:h,step:a.timeStep,value:null!=d?`${d}`:void 0,onCalciteInputTimePickerChange:k=>this._saveValueFromDateComponent(k.target)})}_renderTimestampOffsetFieldComponents(a,b){const {name:c,range:d,valid:g,value:f}=a,{class:h,key:k,readOnly:x}=b,{rawMax:y,rawMin:w}=d;b={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!g,numberingSystem:v.numberingSystem,overlayPositioning:"fixed",readOnly:x,["data-field-name"]:c,
onfocus:this._onComponentFocus};const p=v.prepareISOFieldValueForDateComponents(y),A=v.prepareISOFieldValueForDateComponents(w),z=v.prepareISOFieldValueForDateComponents(f);return e.tsx("div",{class:l.css.dateInputContainer,key:`${k}-date-time-container`},e.tsx("calcite-input-date-picker",{...b,class:h,"data-date-part":"date",key:`${k}-date-input`,max:p?.date??void 0,min:A?.date??void 0,onblur:u=>{this._focusedFieldName=null;this._saveValueFromDateComponent(u.target)},value:z.date??void 0,onCalciteInputDatePickerChange:u=>
this._saveValueFromDateComponent(u.target)}),e.tsx("calcite-input-time-picker",{...b,class:h,"data-date-part":"time",key:`${k}-time-input`,onblur:u=>{this._focusedFieldName=null;this._saveValueFromDateComponent(u.target)},step:a.timeStep,value:z.time??void 0,onCalciteInputTimePickerChange:u=>this._saveValueFromDateComponent(u.target)}),a.includeTimeOffset?e.tsx("calcite-input-time-zone",{...b,class:h,"data-date-part":"timeZone",disabled:x,key:`${k}-timezone-input`,onblur:u=>{this._focusedFieldName=
null;this._saveValueFromDateComponent(u.target)},value:z.timeZoneOffset??"0",onCalciteInputTimeZoneChange:u=>this._saveValueFromDateComponent(u.target)}):null)}_renderDateFieldComponents(a,b){const {includeTime:c,name:d,valid:g,value:f}=a,{class:h,key:k,max:x,min:y,readOnly:w}=b;var {timeZone:p}=this;a={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!g,numberingSystem:v.numberingSystem,overlayPositioning:"fixed",readOnly:w,["data-field-name"]:d,
onfocus:this._onComponentFocus};b=v.prepareUnixFieldValueForDateComponents(f,p);const A=v.prepareUnixFieldValueForDateComponents(x,p);p=v.prepareUnixFieldValueForDateComponents(y,p);return e.tsx("div",{class:l.css.dateInputContainer,key:`${k}-date-time-container`},e.tsx("calcite-input-date-picker",{...a,class:h,"data-date-part":"date",key:`${k}-date-input`,max:A?.date??void 0,min:p?.date??void 0,onblur:z=>{this._focusedFieldName=null;this._saveValueFromDateComponent(z.target)},value:b.date??void 0,
onCalciteInputDatePickerChange:z=>this._saveValueFromDateComponent(z.target)}),c?e.tsx("calcite-input-time-picker",{...a,class:h,"data-date-part":"time",key:`${k}-time-input`,onblur:z=>{this._focusedFieldName=null;this._saveValueFromDateComponent(z.target)},step:1,value:b.time??void 0,onCalciteInputTimePickerChange:z=>this._saveValueFromDateComponent(z.target)}):null)}_renderReadOnlyComponent(a,b){a=this.getCommonInputProps(a);return e.tsx("calcite-input",{...a,class:this.classes(l.css.fieldInput,
l.css.inputDisabled),readOnly:!0,type:"text",value:null!=b?`${b}`:a.value})}_renderComboBoxComponent(a,b,c){const {value:d,name:g}=a,{messages:f,messagesTemplates:h,viewModel:k,_inputsWithChanges:x}=this;b=b.map(u=>u.map(({name:R,value:F})=>e.tsx("calcite-combobox-item",{key:`#${F}`,selected:d===F,textLabel:R,value:`${F}`})));const [y,w]=b;this.viewModel.fieldsWithInvalidCodedValue.has(a)&&w.unshift(e.tsx("calcite-combobox-item",{key:"incompatible-option",readOnly:!0,textLabel:`${a.value}`,value:`${a.value}`}));
b=0<w.length?[e.tsx("calcite-combobox-item-group",{key:"recommended",label:f.recommended},y),e.tsx("calcite-combobox-item-group",{key:"other",label:h.other},w)]:y;const p="INSERT"===k.arcadeEditType,A=x.has(g),z=null==d&&(!p||A);a.showNoValueOptionEnabled&&b.unshift(e.tsx("calcite-combobox-item",{key:"empty-option",selected:z,textLabel:f.empty,value:""},a.showNoValueLabel||f.empty));return e.tsx("calcite-combobox",{...c,allowCustomValues:!1,clearDisabled:!0,disabled:c.readOnly,onblur:p&&a.showNoValueOptionEnabled&&
!A?()=>{}:c.onblur,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({target:u})=>{z&&0===u.selectedItems.length?this._ignoreDeselectionOfNoValueOption(u):this._saveValueFromComponent(u)}},b)}_renderRadioButtonComponents(a,b,c){const {name:d,value:g}=a;b=b.map(({name:f,value:h})=>this._renderRadioButtonComponent({key:f,label:f,name:d,value:h,selected:h===g,props:c}));a.showNoValueOptionEnabled&&b.unshift(this._renderRadioButtonComponent({key:"empty-option",label:a.showNoValueLabel||
this.messages.empty,name:d,value:"",selected:""===g||null===g,props:c}));return e.tsx("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:l.css.inputRadioGroup,"data-field-name":c["data-field-name"],key:`${c.key}-radio-group`,layout:"vertical",name:c.key,required:c.required},b)}_renderSwitchComponent(a,b){const {value:c}=a;a=t.isFieldElementWithInputType(a.element,"switch")?c===a.element.input.onValue:!1;return e.tsx("calcite-switch",
{...b,checked:a,class:l.css.inputSwitch,disabled:b.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:d=>this._saveValueFromComponent(d.target)})}_renderRadioButtonComponent({key:a,name:b,value:c,selected:d,label:g,props:f}){return e.tsx("calcite-label",{class:l.css.inputRadioLabel,key:a,layout:"inline"},e.tsx("calcite-radio-button",{...f,afterCreate:void 0,afterUpdate:void 0,checked:d,class:l.css.inputRadio,disabled:f.readOnly,name:b,onblur:()=>{this._focusedFieldName=null},
value:c,onCalciteRadioButtonChange:({target:h})=>{h.checked&&this._saveValueFromComponent(h)}}),g)}_renderAuxiliaryText(a){var b=a.name;b=this._inputsWithChanges.has(b)&&!a.valid?t.getErrorMessageForFieldInput(a,this.messages,this.timeZone):null!=this.viewModel.contingencyConstraintViolations.get(b)?this.messages.validationErrors.valuesIncompatible:null!=a.valueExpressionExecutor&&a.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return null!=b?e.tsx("calcite-input-message",
{icon:!0,status:"invalid"},b):this._renderDescriptionOrEmpty(a.description)}_renderShowAllRelatedRecordsListItem(a){const {featureCount:b,relationshipId:c,showAllActionVisible:d}=a;({relatedRecordCallbacks:a}=this);if(d&&a?.showAllRelatedRecords)return a=this.messages,e.tsx("calcite-list-item",{description:E.substitute(a.totalCount,{count:b}),label:a.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(c)},e.tsx("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(a){const {canAddRelatedFeature:b,
relationshipId:c,relatedLayer:d}=a,{messages:g,relatedRecordCallbacks:f}=this;if(b&&f?.addRelatedRecord&&d)return e.tsx("calcite-button",{alignment:"center",appearance:"outline-fill",class:l.css.centeredButton,disabled:a.updating||!a.originHasValidKey,iconStart:"plus",key:`${c}-add-button`,onclick:()=>this._onAddRelatedRecordsClick(c,d),round:!0,scale:"s",width:"half"},a.relatedLayerIsTable?g.addRecord:g.addFeature)}_renderRelatedRecordListItem(a,b){const {feature:c,description:d,title:g}=a,{feature:f,
relatedRecordCallbacks:h}=this,{highlightHelper:k}=this.viewModel;return e.tsx("calcite-list-item",{bind:this,description:d,key:`${b}-${c.uid}`,label:g,onclick:()=>{k?.removeAll();h?.editRelatedRecord&&f&&h.editRelatedRecord({parentFeature:f,relationshipId:b,relatedFeature:c})},onmouseenter:k?()=>k.add(c):void 0,onmouseleave:k?()=>k.remove(c):void 0,value:g},e.tsx("calcite-icon",{icon:t.getIconForFeature(c),scale:"m",slot:"content-start"}),e.tsx("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(a){if(this._relatedRecordsEnabled&&
a.editable){var {featureCount:b,relationshipId:c,showAllEnabled:d}=a,g=d?null:this._renderDescriptionOrEmpty(a.description),f=0<b?this._renderRelatedRecordsList(a):a.loaded?a.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(a):void 0;return e.tsx("calcite-label",{class:this.classes(l.css.label,l.css.relatedRecordsLabel),key:`relationship-${c}-container`},e.tsx("div",null,this._renderRelatedRecordsHeaderContainer(a),g,f),this._renderAddRelatedRecordButton(a))}}_renderRelatedRecordsHeaderContainer(a){const b=
a.updating||!a.loaded;return e.tsx("div",{class:l.css.relatedRecordsHeader,key:`relationship-${a.relationshipId}-header`},e.tsx("span",null,a.label),b?e.tsx("calcite-loader",{inline:!0,key:"loader",label:this.messagesCommon?.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(a){const {relationshipId:b}=a;return e.tsx("calcite-list",{class:l.css.relatedRecordsList},a.relatedFeatureInfos.map(c=>this._renderRelatedRecordListItem(c,b)),this._renderShowAllRelatedRecordsListItem(a),
this._renderObserverNode())}_renderNoValidOriginKeyNotice(a){var {messages:b}=this;b=a.relatedLayerIsTable?b.noOriginKeyRecord:b.noOriginKeyFeature;const c=a.relationship?.keyField,d=this.viewModel.findField(c),g=a.layer?.fieldsIndex.get(c);a=E.substitute(b,{relatedLayerName:a.relatedLayer?.title,originKeyField:d?.label||g?.alias||c});return e.tsx("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},e.tsx("div",{slot:"message"},a))}_renderNoRelatedRecordsNotice(){return e.tsx("calcite-notice",
{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},e.tsx("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){if(this.viewModel.activeRelationshipInput?.showAllEnabled)return e.tsx("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:l.css.listObserver,key:"feature-observer"})}getCommonInputProps(a){var {disabled:b}=this;const {editable:c,hint:d,label:g,maxLength:f,minLength:h,name:k,range:{max:x,
min:y},required:w,valid:p,value:A}=a;a=this._inputsWithChanges.has(k);b=!c||b;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":p?"false":"true",class:this.classes(l.css.fieldInput,b?l.css.inputDisabled:null,a&&!p?l.css.inputInvalid:null),key:k,label:g,max:null!=x?x:void 0,min:null!=y?y:void 0,maxLength:-1<f?f:void 0,minLength:-1<h?h:void 0,placeholder:d??void 0,readOnly:b,required:w,value:null==A?"":`${A}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,
onkeydown:this._onComponentKeyDown,["data-field-name"]:k}}_getFieldInputFromHTMLElement(a){return this.viewModel.findField(a.getAttribute("data-field-name"))}_afterDateComponentCreate(a){const b=this._getFieldInputFromHTMLElement(a),c=a.dataset.datePart,d=this._dateComponentMap.get(b.name);if("valueAsDate"in a&&null!=a.value){const g=a.value,f=new ResizeObserver(()=>{a.value=void 0;a.value=g;f.unobserve(a)});f.observe(a)}if(null!=d)switch(c){case "date":d.date=a;break;case "time":d.time=a;break;case "timeZone":d.timeZone=
a}else this._dateComponentMap.set(b.name,{[c]:a});this._afterDateComponentCreateOrUpdate(a)}_afterDateComponentCreateOrUpdate(a){this._afterComponentCreateOrUpdate(a)}_afterComponentCreate(a){const b=this._getFieldInputFromHTMLElement(a);t.isNumberFieldInput(b)&&null!=a.value&&"setNumberValue"in a&&a.setNumberValue({committing:!1,value:a.value,origin:"direct"});this._afterComponentCreateOrUpdate(a)}_afterRadioGroupCreateOrUpdate(a){var b=a.selectedItem;a=a.querySelector("calcite-radio-button");(b=
b||a)&&this._afterComponentCreateOrUpdate(b)}_afterComponentCreateOrUpdate(a){var {viewModel:b}=this;const c=this._getFieldInputFromHTMLElement(a);b=b.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&b===c&&(this._attemptFocusOnNextRender=!1,t.isInputInGroupInput(c)&&(c.group.open=!0),a.setFocus())}_onComponentFocus(a){this._focusedFieldName=this._getFieldInputFromHTMLElement(a.target).name}_onComponentBlur(a){a=a.target;this._focusedFieldName=null;this._saveValueFromComponent(a)}_saveValueFromDateComponent(a){var b=
this._getFieldInputFromHTMLElement(a);const c=b.field.type,{name:d,range:g}=b;if(b=this._dateComponentMap.get(d)){var f=this.viewModel.getValue(d),h=null;"date-only"===c?h=a.value:"time-only"===c?(f=v.normalizeTimeOnlyString(f),h=v.normalizeTimeOnlyString(a.value)):h="timestamp-offset"===c?null!=a.value?v.getISOFieldValueFromDateComponents({dateComponent:b.date,timeComponent:b.time,timeZoneComponent:b.timeZone,oldValue:f}):null:null!=a.value?v.getUnixFieldValueFromDateComponents({oldValue:f,dateComponent:b.date,
timeComponent:b.time,timeZone:this.timeZone,max:g.max,min:g.min}):null;null!==h&&a.value?f!==h&&this._updateFieldValue(d,h):this._updateFieldValue(d,null)}}_saveValueFromComponent(a){const b=this._getFieldInputFromHTMLElement(a);this._updateFieldValue(b.name,this._parseValue(a))}_onComponentKeyDown({key:a,target:b}){b=this._getFieldInputFromHTMLElement(b);"Enter"===a&&t.isInputInGroupInput(b)&&!b.group.open&&(b.group.open=!0)}_updateFieldValue(a,b){this.viewModel.setValue(a,b);this._inputsWithChanges.add(a);
this.viewModel.fieldsWithContingentValues.has(a)&&(a=Object.fromEntries(Object.entries(this.getValues()).filter(([,c])=>null!=c)),this.viewModel.validateContingencyConstraints(a))}_parseValue(a){const b=this._getFieldInputFromHTMLElement(a),c=a.value;return t.isFieldElementWithInputType(b.element,"switch")?a.checked?b.element.input.onValue:b.element.input.offValue:null==c||""===c?null:"number"===b.dataType?"-0"===c||"-0."===c||"-0,"===c?c:parseFloat(c):"date"===b.field.type?parseFloat(c):c}_ignoreDeselectionOfNoValueOption(a){const {firstChild:b,
selectedItems:c}=a;0===c.length&&b&&"selected"in b?b.selected=!0:D.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(a,b){a.open?(b.open=!0,this._focusedFieldName=this._getFocusableInput("forward",b)?.name||null,this._attemptFocusOnNextRender=!0,"sequential"===this.groupDisplay&&this.viewModel.allGroupInputs.forEach(c=>{c!==b&&(c.open=!1)})):b.open=!1;this.scheduleRender()}_onFormSubmit(a){a.preventDefault()}_onFormKeyDown(a){"Enter"===a.key&&
this.viewModel.submit()}_afterListObserverCreated(a){this.viewModel.activeRelationshipInput&&(this._listObserverNode=a)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const a=this.viewModel.activeRelationshipInput;a&&this._listObserverNode&&a.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){this.viewModel.activeRelationshipInput?.incrementPage()}_syncGroupInputStates(){if("sequential"===
this.groupDisplay){var a=this.viewModel.allGroupInputs;if(a.length){var b=a.filter(c=>c.open);0===b.length?a[0].open=!0:1<b.length&&b.slice(1).forEach(c=>c.open=!1)}}}};n.__decorate([r.property()],m.prototype,"_listObserverNode",void 0);n.__decorate([r.property()],m.prototype,"_relatedRecordsEnabled",null);n.__decorate([r.property()],m.prototype,"disabled",null);n.__decorate([r.property()],m.prototype,"feature",null);n.__decorate([r.property()],m.prototype,"formTemplate",null);n.__decorate([r.property()],
m.prototype,"groupDisplay",void 0);n.__decorate([r.property()],m.prototype,"headingLevel",void 0);n.__decorate([r.property()],m.prototype,"label",null);n.__decorate([r.property()],m.prototype,"layer",null);n.__decorate([r.property()],m.prototype,"map",null);n.__decorate([r.property(),C.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],m.prototype,"messages",void 0);n.__decorate([r.property(),C.messageBundle("esri/t9n/common")],m.prototype,"messagesCommon",void 0);n.__decorate([r.property(),
C.messageBundle("esri/widgets/Feature/t9n/Feature")],m.prototype,"messagesFeature",void 0);n.__decorate([r.property(),C.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],m.prototype,"messagesTemplates",void 0);n.__decorate([r.property()],m.prototype,"relatedRecordCallbacks",null);n.__decorate([r.property()],m.prototype,"relationshipId",null);n.__decorate([r.property()],m.prototype,"spatialReference",null);n.__decorate([r.property()],m.prototype,"strict",null);n.__decorate([r.property()],
m.prototype,"timeZone",null);n.__decorate([r.property()],m.prototype,"view",null);n.__decorate([r.property(),Q.vmEvent(["value-change","submit"])],m.prototype,"viewModel",void 0);return m=n.__decorate([L.subclass("esri.widgets.FeatureForm")],m)});