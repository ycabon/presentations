// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../intl ../core/deprecate ../core/Logger ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./FeatureTable/FeatureTableViewModel ./FeatureTable/Grid/support/ButtonMenu ./FeatureTable/Grid/support/ButtonMenuItem ../chunks/componentsUtils ./support/globalCss ./support/Heading ./support/legacyIcon ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),
function(u,d,c,w,x,q,e,A,I,J,B,C,D,E,m,F,G,H,r,K,v,g,y){const z={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0,selectedRecordsShowAllToggle:!0,selectedRecordsShowSelectedToggle:!0,zoomToSelection:!0,deleteSelection:!0},selectionColumn:!0,columnMenus:!0};c=class extends C{constructor(a,b){super(a,b);this.menuConfig=this.menu=this._prompt=null;this.viewModel=new D;this.visibleElements={...z};this._showDeletePrompt=this._showDeletePrompt.bind(this);this._onDeleteSelectionClick=
this._onDeleteSelectionClick.bind(this)}initialize(){this.addHandles([q.on(()=>this.viewModel.columns,"change",()=>this._syncMenuConfig()),q.on(()=>this.viewModel.activeFilters,"change",()=>this._syncMenuConfig()),q.on(()=>this.highlightIds,"change",f=>{this._syncMenuConfig();this._onSelectionChange(f)}),q.watch(()=>[this.viewModel.store.querying,this.viewModel.store.syncing,this.editingEnabled],()=>this.scheduleRender()),q.watch(()=>[this.menuConfig,this.editingEnabled],()=>this._syncMenuConfig()),
q.watch(()=>this.messages,()=>{this.menu&&(this.menu.label=this.messages?.options);this._syncMenuConfig()})]);this._set("menu",new E({label:this.messages?.options,iconClass:r.legacyIcon.handleHorizontal,...this.menuConfig}));const {attachmentsEnabled:a,relatedRecordsEnabled:b}=this;this.viewModel?.store?.set({attachmentsEnabled:a,relatedRecordsEnabled:b})}loadDependencies(){return F.loadCalciteComponents({button:()=>new Promise((a,b)=>u(["../chunks/calcite-button"],a,b)),icon:()=>new Promise((a,b)=>
u(["../chunks/calcite-icon"],a,b)),scrim:()=>new Promise((a,b)=>u(["../chunks/calcite-scrim"],a,b))})}destroy(){this._prompt=null;this.menu?.destroy()}get activeFilters(){return this.viewModel.activeFilters}get activeSortOrders(){return this.viewModel.activeSortOrders}get attachmentsEnabled(){return this.viewModel.attachmentsEnabled}set attachmentsEnabled(a){this.viewModel.attachmentsEnabled=a}get autoRefreshEnabled(){return this.viewModel.autoRefreshEnabled}set autoRefreshEnabled(a){this.viewModel.autoRefreshEnabled=
a}get columnReorderingEnabled(){return this.viewModel.columnReorderingEnabled}set columnReorderingEnabled(a){this.viewModel.columnReorderingEnabled=a}get columns(){return this.viewModel.columns}get editingEnabled(){return this.viewModel.editingEnabled}set editingEnabled(a){this.viewModel.editingEnabled=a}get filterGeometry(){return this.viewModel.filterGeometry}set filterGeometry(a){this.viewModel.filterGeometry=a}get grid(){return this.viewModel.grid}get hiddenFields(){return this.viewModel.hiddenFields}set hiddenFields(a){this.viewModel.hiddenFields=
a}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(a){this.viewModel.highlightEnabled=a}get highlightIds(){return this.viewModel.highlightIds}set highlightIds(a){this.viewModel.highlightIds=a}get highlightOnRowSelectEnabled(){return this.viewModel.highlightEnabled}set highlightOnRowSelectEnabled(a){this.viewModel.highlightEnabled=a}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",a)}get layer(){return this.viewModel.layer}set layer(a){this.viewModel.layer=
a}get messages(){return this.viewModel.messages}set messages(a){this.viewModel.messages=a}get messagesCommon(){return this.viewModel.messagesCommon}set messagesCommon(a){this.viewModel.messagesCommon=a}get messagesURIUtils(){return this.viewModel.messagesURIUtils}set messagesURIUtils(a){this.viewModel.messagesURIUtils=a}get multiSortEnabled(){return this.viewModel.multiSortEnabled}set multiSortEnabled(a){this.viewModel.multiSortEnabled=a}get pageSize(){return this.viewModel.pageSize}set pageSize(a){this.viewModel.pageSize=
a}get relatedRecordsEnabled(){return this.viewModel.relatedRecordsEnabled}set relatedRecordsEnabled(a){this.viewModel.relatedRecordsEnabled=a}get state(){return this.viewModel.state}get tableTemplate(){return this.viewModel.tableTemplate}set tableTemplate(a){this.viewModel.tableTemplate=a}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(a){this.viewModel.timeExtent=a}get timeZone(){return this.viewModel.timeZone}set timeZone(a){this.viewModel.timeZone=a}get view(){return this.viewModel.view}set view(a){this.viewModel.view=
a}castVisibleElements(a){a={...z,...a};this.grid?.set("visibleElements",{...this.grid.visibleElements,selectionColumn:a.selectionColumn,columnMenus:a.columnMenus});return a}clearHighlights(){w.deprecatedFunction(x.getLogger(this),"`FeatureTable.clearHighlights` is deprecated in favor of FeatureTable.highlightIds'",{replacement:"FeatureTable.highlightIds",version:"4.25",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-FeatureTable.html#highlightIds"});return this.viewModel.clearHighlights()}clearSelection(){w.deprecatedFunction(x.getLogger(this),
"`FeatureTable.clearSelection` is deprecated in favor of FeatureTable.highlightIds'",{replacement:"FeatureTable.highlightIds",version:"4.25",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-FeatureTable.html#highlightIds"});return this.viewModel.clearSelection()}clearSelectionFilter(){return this.viewModel.clearSelectionFilter()}deleteSelection(a){return this.highlightIds.length?a?(this._showDeletePrompt(),this.scheduleRender(),Promise.resolve()):this.viewModel.deleteSelection():
Promise.resolve()}deselectRows(a){return this.viewModel.deselectRows(a)}filterBySelection(){return this.viewModel.filterBySelection()}findColumn(a){return this.viewModel.findColumn(a)}hideColumn(a){this.grid?.hideColumn(a);this._syncMenuConfig()}refresh(){return this.viewModel.refresh()}get returnGeometryEnabled(){return this.viewModel.returnGeometryEnabled}set returnGeometryEnabled(a){this.viewModel.returnGeometryEnabled=a}showAllColumns(){return this.viewModel.showAllColumns()}showColumn(a){this.grid?.showColumn(a);
this._syncMenuConfig()}sortColumn(a,b){return this.viewModel.sortColumn(a,b)}selectRows(a){return this.viewModel.selectRows(a)}scrollToIndex(a){return this.viewModel.scrollToIndex(a)}zoomToSelection(){this.viewModel.zoomToSelection()}render(){var {_prompt:a}=this;a=null!=a?g.tsx("calcite-scrim",null,this._renderPrompt(a)):null;return g.tsx("div",{bind:this,class:this.classes("esri-feature-table",G.globalCss.widget)},this.visibleElements.header?this._renderHeader():null,g.tsx("div",{class:"esri-feature-table__content"},
"disabled"!==this.state&&this.grid?.render()),a)}_renderPrompt({title:a,message:b,context:f,actions:k}){const h=g.tsx("calcite-button",{appearance:"solid",key:"prompt-primary-button",kind:"danger"===f?"danger":"brand",onclick:k.primary.action,width:k.secondary?"half":"full"},k.primary.label);k=k.secondary?g.tsx("calcite-button",{appearance:"outline",key:"prompt-secondary-button",kind:"danger"===f?"danger":"brand",onclick:k.secondary.action,width:"half"},k.secondary.label):null;return g.tsx("div",
{class:`${"esri-feature-table__prompt"}--${f}`},g.tsx("div",{class:"esri-feature-table__prompt__header"},g.tsx("calcite-icon",{icon:"exclamation-mark-triangle"}),g.tsx(H.Heading,{class:"esri-feature-table__prompt__header__heading",level:2},a)),g.tsx("div",{class:"esri-feature-table__prompt__message"},b),g.tsx("div",{class:"esri-feature-table__prompt__divider"}),g.tsx("div",{class:"esri-feature-table__prompt__actions"},k,h))}_renderHeader(){return g.tsx("div",{class:"esri-feature-table__header",key:"header"},
this._renderLoader(),this._renderTitle(),this.visibleElements.menu?this._renderMenu():null)}_renderTitle(){return g.tsx("div",{class:"esri-feature-table__title",key:"title"},this._getTitle())}_getTitle(){const {grid:a,highlightIds:b,layer:f,messages:k,viewModel:{size:h}}=this;return a&&f?y.substitute(k.header,{title:f.title,count:h,selected:b.length||0}):""}_renderLoader(){const {state:a,store:b}=this.viewModel;return g.tsx("div",{class:"esri-feature-table__loader-container"},"loading"===a||b.syncing||
b.querying?g.tsx("div",{class:"esri-feature-table__loader",key:"loader"}):null)}_renderMenu(){return g.tsx("div",{class:"esri-feature-table__menu"},this.menu?.render())}_onSelectionChange(a){const {added:b,removed:f}=a;a=b.map(h=>this.viewModel.store.getLocalItemByKey(h)||{objectId:h,feature:null,attachments:null,relatedRecords:null});const k=f.map(h=>this.viewModel.store.getLocalItemByKey(h)||{objectId:h,feature:null,attachments:null,relatedRecords:null});this.emit("selection-change",{added:a,removed:k})}_syncMenuConfig(){this.menu?.set({...this.menuConfig,
items:this._getMenuItems()})}_getMenuItems(){const a=this.menuConfig?.items,b=this._getDefaultMenuItems(),f=[];b?.length&&f.push(...b);a?.length&&f.push(...a);return f}_getDefaultMenuItems(){const {highlightIds:a,messages:b,viewModel:f,visibleElements:k}=this,{menuItems:h}=k,l=[];h?.refreshData&&l.push(new m({selectionEnabled:!1,label:b?.refreshData,clickFunction:()=>this.refresh()}));if(a.length){const n=this._getSelectionFilter();h?.clearSelection&&l.push(new m({selectionEnabled:!1,label:b?.clearSelection,
clickFunction:()=>this.highlightIds?.removeAll()}));h?.zoomToSelection&&this.view&&l.push(new m({selectionEnabled:!1,label:b?.zoomToSelection,clickFunction:()=>this.viewModel.zoomToSelection()}));if(h?.selectedRecordsShowSelectedToggle&&(!n||a.length!==n.objectIds.length)){const p=b.showSelected,t=new m({selectionEnabled:!1,label:p,clickFunction:()=>{this.filterBySelection();t.set("label",p)}});l.push(t)}h?.deleteSelection&&this.editingEnabled&&this.layer?.capabilities?.operations?.supportsDelete&&
l.push(new m({selectionEnabled:!1,label:b.deleteSelection,clickFunction:this._showDeletePrompt}))}if(h?.selectedRecordsShowAllToggle&&this._hasSelectionFilter()){const n=b.showAllRecords,p=new m({selectionEnabled:!1,label:n,clickFunction:()=>{this.clearSelectionFilter();p.set("label",n)}});l.push(p)}h?.toggleColumns&&l.push(new m({iconClass:r.legacyIcon.right,label:b?.toggleColumns,clickFunction:this._toggleMenuItemSelectedIcon,items:f?.columns?.items.map(({header:n,hidden:p,path:t})=>new m({label:n||
t,selected:!p,selectionEnabled:!0,iconClass:r.legacyIcon.checkMark,clickFunction:()=>this._toggleColumnFromMenuItem(t)}))}));return l.length?l:null}_toggleMenuItemSelectedIcon({item:a}){a?.set("iconClass",a?.selected?r.legacyIcon.down:r.legacyIcon.right)}_toggleColumnFromMenuItem(a){const {grid:b,viewModel:f}=this;f.findColumn(a)?.hidden?b?.showColumn(a):b?.hideColumn(a)}_showDeletePrompt(){const {messages:a,messagesCommon:b}=this,f=y.substitute(a.deleteSelectionCount,{count:this.highlightIds.length||
0});this.menu&&(this.menu.open=!1);this._prompt={title:f,message:a.deleteRecordsRemoved,context:"danger",actions:{primary:{label:b.delete,action:this._onDeleteSelectionClick},secondary:{label:a.keepRecords,action:()=>this._prompt=null}}}}async _onDeleteSelectionClick(){await this.viewModel.deleteSelection();this._prompt=null}_getSelectionFilter(){return this.viewModel.activeFilters?.find(a=>"selection"===a.type)}_hasSelectionFilter(){return!!this._getSelectionFilter()}};d.__decorate([e.property({readOnly:!0})],
c.prototype,"activeFilters",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"activeSortOrders",null);d.__decorate([e.property()],c.prototype,"attachmentsEnabled",null);d.__decorate([e.property()],c.prototype,"autoRefreshEnabled",null);d.__decorate([e.property()],c.prototype,"columnReorderingEnabled",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"columns",null);d.__decorate([e.property()],c.prototype,"editingEnabled",null);d.__decorate([e.property()],c.prototype,"filterGeometry",
null);d.__decorate([e.property({readOnly:!0})],c.prototype,"grid",null);d.__decorate([e.property()],c.prototype,"hiddenFields",null);d.__decorate([e.property()],c.prototype,"highlightEnabled",null);d.__decorate([e.property()],c.prototype,"highlightIds",null);d.__decorate([e.property()],c.prototype,"highlightOnRowSelectEnabled",null);d.__decorate([e.property()],c.prototype,"label",null);d.__decorate([e.property()],c.prototype,"layer",null);d.__decorate([e.property(),v.messageBundle("esri/widgets/FeatureTable/t9n/FeatureTable")],
c.prototype,"messages",null);d.__decorate([e.property(),v.messageBundle("esri/t9n/common")],c.prototype,"messagesCommon",null);d.__decorate([e.property(),v.messageBundle("esri/widgets/support/t9n/uriUtils")],c.prototype,"messagesURIUtils",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"menu",void 0);d.__decorate([e.property()],c.prototype,"menuConfig",void 0);d.__decorate([e.property()],c.prototype,"multiSortEnabled",null);d.__decorate([e.property()],c.prototype,"pageSize",null);d.__decorate([e.property()],
c.prototype,"relatedRecordsEnabled",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"state",null);d.__decorate([e.property()],c.prototype,"tableTemplate",null);d.__decorate([e.property()],c.prototype,"timeExtent",null);d.__decorate([e.property()],c.prototype,"timeZone",null);d.__decorate([e.property()],c.prototype,"view",null);d.__decorate([e.property()],c.prototype,"viewModel",void 0);d.__decorate([e.property()],c.prototype,"visibleElements",void 0);d.__decorate([A.cast("visibleElements")],
c.prototype,"castVisibleElements",null);d.__decorate([e.property()],c.prototype,"returnGeometryEnabled",null);return c=d.__decorate([B.subclass("esri.widgets.FeatureTable")],c)});