// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./Column ../../support/uriUtils".split(" "),function(g,p,h,d,u,v,r,t,q){d=class extends t{constructor(e){super(e);this.activeEditInfo=null;this.cellValueValidatorFunction=({oldValue:a,value:b})=>a!==b;this.editable=!1;this.inputRenderFunction=({root:a,column:b,rowData:c})=>{if(!this.activeEditInfo?.updating&&
this.editable){var k=this.getCellValue(b,c),f=this.createInputElement({root:a,column:b,rowData:c,value:k});this._set("activeEditInfo",{column:b,input:f,root:a,rowData:c,updating:!0,oldValue:k});b=this.createInputContainer();b.appendChild(f);this.removeCellContent(a);a.appendChild(b);f.focus();f instanceof HTMLInputElement&&f.select()}};this.loadingMessage="";this.inputType="text";this.maxLength=null;this.parseInputValueFunction=({input:a})=>a.value;this.renderFunction=a=>{const {root:b,column:c,rowData:k}=
a;var {activeEditInfo:f}=this;if(!f||!f.updating){var l=this.getCellValue(c,k);f=this.cellValueFormatFunction({column:c,rowData:k,value:l});b.onclick=()=>b.focus();b.ondblclick=()=>this.inputRenderFunction(a);b.ontouchend=()=>this.inputRenderFunction(a);var m=this.grid?.getSlotElementByName(b.slot)?.parentElement;m&&!m.onkeydown&&(m.onkeydown=n=>{"Enter"!==n.key||this.activeEditInfo||this.inputRenderFunction(a);"Escape"===n.key&&this.activeEditInfo&&this.cancel()});null!=l&&null!=f?b.title=f.toString():
b.title&&b.removeAttribute("title");l=q.autoLink(this.messagesURIUtils,f);f?.toString()!==b.innerHTML&&l!==b.innerHTML&&(b.innerHTML=l)}};this.required=!1;this.store=null;this.updateRowItemFunction=({rowData:a,column:b,value:c})=>{p.assertIsSome(a);b.path&&a?.item&&(a.item[b.path]=c)};this.updateStoreItemFunction=async({rowData:a,column:b,value:c})=>{p.assertIsSome(a);b.path&&await this.store?.updateItem({index:a.index,name:b.path,value:c})}}cancel(){const {activeEditInfo:e}=this;if(e){var {column:a,
root:b,rowData:c}=e;this._set("activeEditInfo",null);this.renderFunction({column:a,root:b,rowData:c})}}createInputContainer(){const e=document.createElement("div");e.classList.add("esri-editor-column__cell-input--container");return e}createInputElement({value:e}){const a=document.createElement("input");a.classList.add("esri-editor-column__cell-input");null!=this.maxLength&&(a.maxLength=this.maxLength);a.type=this.inputType;a.value=e;a.onblur=()=>{a.onblur=null;this.submit()};return a}async submit(){var {activeEditInfo:e}=
this;if(e){var {column:a,input:b,root:c,rowData:k,oldValue:f}=e;e=this.parseInputValueFunction({input:b,column:a,rowData:k});if(this.cellValueValidatorFunction({value:e,oldValue:f,column:a,rowData:k})){c.innerHTML=this.loadingMessage;try{await this.updateStoreItemFunction({rowData:k,column:a,value:e});this.updateRowItemFunction({rowData:k,column:a,value:e});const l=this.getCellValue(a,k),m=this.cellValueFormatFunction({column:a,rowData:k,value:l});null!=l&&null!=m?c.title=m.toString():c.title&&c.removeAttribute("title");
const n=q.autoLink(this.messagesURIUtils,m);c.innerHTML=n;this.emit("value-change",{column:a,rowData:k,value:l});this._set("activeEditInfo",null)}catch(l){this.cancel()}}else this.cancel()}}};g.__decorate([h.property({readOnly:!0})],d.prototype,"activeEditInfo",void 0);g.__decorate([h.property()],d.prototype,"cellValueValidatorFunction",void 0);g.__decorate([h.property()],d.prototype,"editable",void 0);g.__decorate([h.property()],d.prototype,"inputRenderFunction",void 0);g.__decorate([h.property({constructOnly:!0})],
d.prototype,"loadingMessage",void 0);g.__decorate([h.property()],d.prototype,"inputType",void 0);g.__decorate([h.property()],d.prototype,"maxLength",void 0);g.__decorate([h.property()],d.prototype,"parseInputValueFunction",void 0);g.__decorate([h.property()],d.prototype,"renderFunction",void 0);g.__decorate([h.property()],d.prototype,"required",void 0);g.__decorate([h.property()],d.prototype,"store",void 0);g.__decorate([h.property()],d.prototype,"updateRowItemFunction",void 0);g.__decorate([h.property()],
d.prototype,"updateStoreItemFunction",void 0);return d=g.__decorate([r.subclass("esri.widgets.FeatureTable.Grid.EditorColumn")],d)});