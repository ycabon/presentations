// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../core/Collection ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./ListItem ./support/layerListUtils".split(" "),function(h,e,u,f,k,w,x,y,v,n,m){const p=e.ofType(n);e=class extends u.EventedAccessor{constructor(a){super(a);this.checkPublishStatusEnabled=!1;this.listItemCreatedFunction=null;this.operationalItems=new p;this.view=
null}initialize(){this.addHandles([f.watch(()=>!0===this.view?.ready,()=>this._viewHandles(),f.initial),f.watch(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],"view")}destroy(){this.view=null;this.operationalItems.removeAll()}get state(){const {view:a}=this;return a?.ready?"ready":a?"loading":"disabled"}triggerAction(a,b){a&&!a.disabled&&this.emit("trigger-action",{action:a,item:b})}moveListItem(a,b,c,d){const l=a?.layer;if(l){var g=this.view?.map?.layers,
q=b?m.getItemLayers(b):g;g=c?m.getItemLayers(c):g;if(q&&g){var {operationalItems:r}=this,t=c?.children||r;d=g.length-d;a.parent=c||null;(b?.children||r).remove(a);q.remove(l);t.includes(a)||t.add(a,d);g.includes(l)||g.add(l,d);this._compileList()}}}_createLayerViewHandles(a){this.removeHandles("layer-views");this._compileList();a&&this.addHandles(a.on("change",()=>this._compileList()),"layer-views")}_createMapLayerHandles(a){this.removeHandles("map-layers");this._compileList();a&&this.addHandles(a.on("change",
()=>this._compileList()),"map-layers")}_createListItem(a){const {view:b,listItemCreatedFunction:c,checkPublishStatusEnabled:d}=this;return new n({checkPublishStatusEnabled:d,layer:a,listItemCreatedFunction:c,view:b})}_removeAllItems(){this.operationalItems.removeAll()}_getViewableLayers(a){if(a)return a.filter(b=>"hide"!==m.findLayerListMode(b))}_watchLayersListMode(a){this.removeHandles("layer-list-mode");a&&a.forEach(b=>{"listMode"in b&&this.addHandles(f.watch(()=>b.listMode,()=>this._compileList()),
"layer-list-mode")})}_compileList(){var a=this.view?.map?.layers;this._watchLayersListMode(a);a=this._getViewableLayers(a);a?.length?(this._createNewItems(a),this._removeItems(a),this._sortItems(a)):this._removeAllItems()}_createNewItems(a){const {operationalItems:b}=this;a.forEach(c=>{b.some(d=>d.layer===c)||b.add(this._createListItem(c))})}_removeItems(a){const {operationalItems:b}=this,c=[];b.forEach(d=>{d&&a&&a.includes(d.layer)||c.push(d)});b.removeMany(c)}_sortItems(a){const {operationalItems:b}=
this;b.sort((c,d)=>{c=a.indexOf(c.layer);d=a.indexOf(d.layer);return c>d?-1:c<d?1:0})}_recompileList(){this._removeAllItems();this._compileList()}_viewHandles(){const {view:a}=this;this.removeHandles(["map-layers","layer-views","view-layers"]);a?.ready?this.addHandles([f.watch(()=>this.view?.map?.allLayers,b=>this._createMapLayerHandles(b),f.initial),f.watch(()=>this.view?.allLayerViews,b=>this._createLayerViewHandles(b),f.initial)],"view-layers"):this._removeAllItems()}};h.__decorate([k.property()],
e.prototype,"checkPublishStatusEnabled",void 0);h.__decorate([k.property()],e.prototype,"listItemCreatedFunction",void 0);h.__decorate([k.property({type:p})],e.prototype,"operationalItems",void 0);h.__decorate([k.property({readOnly:!0})],e.prototype,"state",null);h.__decorate([k.property()],e.prototype,"view",void 0);return e=h.__decorate([v.subclass("esri.widgets.LayerList.LayerListViewModel")],e)});