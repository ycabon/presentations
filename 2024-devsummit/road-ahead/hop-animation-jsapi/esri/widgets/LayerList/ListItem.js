// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../core/Accessor ../../core/arrayUtils ../../core/Collection ../../core/Identifiable ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/get ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionSlider ../../support/actions/ActionToggle ./ListItemPanel ./support/layerListUtils".split(" "),
function(d,b,r,l,t,g,e,u,n,v,m,w,x,y,z,p,h){var k;n=l.ofType({key:"type",defaultKeyValue:"button",base:w,typeMap:{button:x,toggle:z,slider:y}});const q=l.ofType(n);b=k=class extends t.IdentifiableMixin(b){constructor(a){super(a);this.actionsSections=new q;this.checkPublishStatusEnabled=this.actionsOpen=!1;this.children=new (l.ofType(k));this.childrenSortable=!0;this.hidden=!1;this.listItemCreatedFunction=this.layerView=this.layer=null;this.open=!1;this.parent=this.panel=null;this.sortable=!0;this.view=
null}initialize(){this.addHandles([g.watch(()=>[this.layer,this.layer?.listMode],()=>this._watchLayerProperties(this.layer),g.initial),g.watch(()=>this.checkPublishStatusEnabled,a=>this._updateChildrenPublishing(a),g.initial),g.watch(()=>this.view,a=>this._updateChildrenView(a),g.initial),g.watch(()=>this.panel,a=>this._setListItemOnPanel(a),g.initial),g.watch(()=>[this.layer,this.view],()=>this._getLayerView(),g.initial)]);"function"===typeof this.listItemCreatedFunction&&this.listItemCreatedFunction.call(null,
{item:this})}destroy(){this.view=null}get connectionStatus(){const {layerView:a,publishing:c}=this;if(!c&&a&&"connectionStatus"in a)return a.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){const {layerView:a}=this;return a&&"spatialReferenceSupported"in a?!a.spatialReferenceSupported:!1}castPanel(a){this.panel?.open&&!a.hasOwnProperty("open")&&(a.open=!0);return a?new p(a):null}get title(){const a=m.get(this,"layer.layer");return(!a||a&&m.get(this,"layer.layer.loaded"))&&
m.get(this,"layer.title")||m.get(this,"layer.attributes.title")||""}set title(a){this._override("title",a)}get publishing(){const {layer:a,checkPublishStatusEnabled:c}=this;return c&&a&&"publishingInfo"in a&&"publishing"===a.publishingInfo?.status}get updating(){const {layerView:a,connectionStatus:c,layer:f,publishing:A}=this;return A||c?!1:a?a.updating:"loading"===f?.loadStatus||!1}get visible(){return this.layer?.visible}set visible(a){const c=this.layer;c&&(c.visible=a)}get visibleAtCurrentScale(){return!h.isLayerOutsideScaleRange(this.layer,
this.view?.scale)}get visibilityMode(){return h.findLayerVisibilityMode(this.layer)}clone(){return new k({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,
visible:this.visible})}_setListItemOnPanel(a){a&&(a.listItem=this)}_updateChildrenPublishing(a){const c=this.children;c&&c.forEach(f=>f.checkPublishStatusEnabled=a)}_updateChildrenView(a){const c=this.children;c&&c.forEach(f=>f.view=a)}_addChildren(a){this.removeHandles("child-list-mode");this.children.removeAll();if(a){a.forEach(f=>{this.addHandles(g.watch(()=>f.listMode,()=>this._addChildren(a)),"child-list-mode")});var c=a.filter(f=>"hide"!==h.findLayerListMode(f));this.children.addMany(this._makeChildren(c))}}_watchSublayerChanges(a){a&&
this.addHandles(a.on("change",()=>{this._addChildren(a)}),"layer")}_initializeChildLayers(a){this._addChildren(a);this._watchSublayerChanges(a)}_makeChildren(a){return a.map(c=>h.canDisplayLayer(c)?new k({layer:c,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,parent:this,view:this.view}):null).filter(r.isSome).reverse()}_watchLayerProperties(a){this.removeHandles("layer");this.removeHandles("child-list-mode");if(a)if("hide-children"===
h.findLayerListMode(a))this.children.removeAll();else{var c=h.getNormalizedChildLayerProperty(a);c&&this.addHandles(g.watch(()=>a[c],f=>{a.hasOwnProperty(c)&&this._initializeChildLayers(f)},g.initial),"layer")}}async _getLayerView(){const {layer:a,view:c}=this;if(a&&c)try{const f=await c.whenLayerView(a);f.layer===this.layer&&this._set("layerView",f)}catch{}}};d.__decorate([e.property({type:q})],b.prototype,"actionsSections",void 0);d.__decorate([e.property()],b.prototype,"actionsOpen",void 0);d.__decorate([e.property()],
b.prototype,"checkPublishStatusEnabled",void 0);d.__decorate([e.property({type:l})],b.prototype,"children",void 0);d.__decorate([e.property()],b.prototype,"childrenSortable",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"connectionStatus",null);d.__decorate([e.property({readOnly:!0})],b.prototype,"error",null);d.__decorate([e.property()],b.prototype,"hidden",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"incompatible",null);d.__decorate([e.property()],b.prototype,"layer",
void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"layerView",void 0);d.__decorate([e.property()],b.prototype,"listItemCreatedFunction",void 0);d.__decorate([e.property()],b.prototype,"open",void 0);d.__decorate([e.property({type:p})],b.prototype,"panel",void 0);d.__decorate([u.cast("panel")],b.prototype,"castPanel",null);d.__decorate([e.property()],b.prototype,"parent",void 0);d.__decorate([e.property()],b.prototype,"sortable",void 0);d.__decorate([e.property()],b.prototype,"title",null);
d.__decorate([e.property({readOnly:!0})],b.prototype,"publishing",null);d.__decorate([e.property({readOnly:!0})],b.prototype,"updating",null);d.__decorate([e.property()],b.prototype,"view",void 0);d.__decorate([e.property()],b.prototype,"visible",null);d.__decorate([e.property({readOnly:!0})],b.prototype,"visibleAtCurrentScale",null);d.__decorate([e.property({readOnly:!0})],b.prototype,"visibilityMode",null);return b=k=d.__decorate([v.subclass("esri.widgets.LayerList.ListItem")],b)});