// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./Measurement/MeasurementViewModel ./support/legacyIcon ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),function(n,c,t,q,e,b,A,B,u,v,r,w,C,x,y){const p=a=>Object.freeze(Object.defineProperty({__proto__:null,default:a},Symbol.toStringTag,{value:"Module"}));
var z=w.legacyIcon.measure;b=class extends v{constructor(a,f){super(a,f);this._widgets=new Map;this.activeWidget=null;this.iconClass=z;this.messages=this.icon=null;this.viewModel=new r}initialize(){this.activeWidget&&this.viewModel.set("activeViewModel",this.activeWidget.viewModel);this.view&&this.activeTool&&this._getActiveWidget().then(a=>{this._set("activeWidget",a)});this.addHandles([q.watch(()=>[this.view,this.activeTool],async()=>{this._set("activeWidget",await this._getActiveWidget())}),q.watch(()=>
this.activeWidget,(a,f)=>{this.viewModel.set("activeViewModel",a?a.viewModel:null);f&&(f.visible=!1)}),q.watch(()=>[this.areaUnit,this.linearUnit,this.uiStrings],()=>this._updateSubWidgetProperties())])}destroy(){this._destroyWidgets()}get activeTool(){return this.viewModel.activeTool}set activeTool(a){this.viewModel.activeTool=a}get areaUnit(){return this.viewModel.areaUnit}set areaUnit(a){this.viewModel.areaUnit=a}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",
a)}get linearUnit(){return this.viewModel.linearUnit}set linearUnit(a){this.viewModel.linearUnit=a}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}render(){var {activeWidget:a}=this;a=a&&!a.destroyed?a.render():null;return y.tsx("div",{class:"esri-measurement"},a)}clear(){this.activeTool=null;this._destroyWidgets()}startMeasurement(){const {activeViewModel:a}=this.viewModel;a&&t.ignoreAbortErrors(a.start())}async _createWidget(a){const {areaUnit:f,linearUnit:d,view:g}=this;
if(!g)return null;switch(a){case "area":var {type:m}=g;switch(m){case "2d":return new (await new Promise((h,k)=>n(["./AreaMeasurement2D"],l=>h(p(l)),k))).default({view:g,unit:f,uiStrings:this._createUIStringsForWidget(a)});case "3d":return new (await new Promise((h,k)=>n(["./AreaMeasurement3D"],l=>h(p(l)),k))).default({view:g,unit:f,uiStrings:this._createUIStringsForWidget(a)});default:return null}case "distance":switch({type:m}=g,m){case "2d":return new (await new Promise((h,k)=>n(["./DistanceMeasurement2D"],
l=>h(p(l)),k))).default({view:g,unit:d,uiStrings:this._createUIStringsForWidget(a)});default:return null}case "direct-line":switch({type:m}=g,m){case "3d":return new (await new Promise((h,k)=>n(["./DirectLineMeasurement3D"],l=>h(p(l)),k))).default({view:g,unit:d,uiStrings:this._createUIStringsForWidget(a)});default:return null}default:return null}}_destroyWidgets(){this._widgets.forEach(a=>a.destroy());this._widgets.clear()}async _getActiveWidget(){const {activeTool:a,view:f}=this;if(!f||!a)return null;
let d=null;if(this._widgets.has(a))d=this._widgets.get(a),d.visible=!0;else{d=await this._createWidget(a);if(!d)return null;await d.viewModel.start();this._widgets.set(a,d)}return d}_createUIStringsForWidget(a){if(this.uiStrings)return this.uiStrings[a+"-"+this.view?.type]}_updateSubWidgetProperties(){this._widgets.forEach((a,f)=>{const {areaUnit:d,linearUnit:g}=this;a.unit="esri.widgets.AreaMeasurement2D"===a?.declaredClass||"esri.widgets.AreaMeasurement3D"===a?.declaredClass?d:g;a.uiStrings=this._createUIStringsForWidget(f)})}};
c.__decorate([e.property()],b.prototype,"activeTool",null);c.__decorate([e.property({readOnly:!0})],b.prototype,"activeWidget",void 0);c.__decorate([e.property()],b.prototype,"areaUnit",null);c.__decorate([e.property()],b.prototype,"iconClass",void 0);c.__decorate([e.property()],b.prototype,"icon",void 0);c.__decorate([e.property()],b.prototype,"label",null);c.__decorate([e.property()],b.prototype,"linearUnit",null);c.__decorate([e.property(),x.messageBundle("esri/widgets/Measurement/t9n/Measurement")],
b.prototype,"messages",void 0);c.__decorate([e.property()],b.prototype,"uiStrings",void 0);c.__decorate([e.property()],b.prototype,"view",null);c.__decorate([e.property({type:r})],b.prototype,"viewModel",void 0);return b=c.__decorate([u.subclass("esri.widgets.Measurement")],b)});