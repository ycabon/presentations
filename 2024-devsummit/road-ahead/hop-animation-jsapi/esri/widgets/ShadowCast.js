// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../intl ../core/maybe ../core/reactiveUtils ../core/timeUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../intl/substitute ./Slider ./Widget ./ShadowCast/css ./ShadowCast/ShadowCastState ./ShadowCast/ShadowCastViewModel ./ShadowCast/ShadowCastVisibleElements ./ShadowCast/ShadowVisualizationType ./ShadowCast/components/DiscreteConfigurator ./ShadowCast/components/DurationConfigurator ./ShadowCast/components/ShadowTooltip ./ShadowCast/components/ThresholdConfigurator ../chunks/componentsUtils ./support/DatePicker ./support/globalCss ./support/Heading ./support/timeWidgetUtils ./support/TimezonePicker ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/date".split(" "),
function(u,g,e,v,l,w,h,T,U,V,z,A,B,C,m,D,E,x,p,F,G,H,I,J,K,q,y,L,M,W,N,d,O){var t;(t||={}).Slider="slider";const P={hour:"2-digit",minute:"2-digit",timeZone:"UTC"},Q=/(.*)\s(.*)/,R={labelFormatFunction:L.formatSliderLabel,min:0,max:1439,steps:15,rangeLabelInputsEnabled:!1,visibleElements:{labels:!1,rangeLabels:!1},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:(a,b,c)=>{b.classList.add(q.globalCss.primaryTick);c.classList.add(q.globalCss.primaryTickLabel);
if(a=c.innerText.match(Q))c.innerHTML=`${a[1]}<br><div class="${q.globalCss.primaryTickAmPm}">${a[2]}</div>`}},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:(a,b)=>{b.classList.add(q.globalCss.secondaryTick)}}]};e=class extends C{constructor(a,b){super(a,b);this.viewModel=null;this.headingLevel=4;this.iconClass=m.css.widgetIcon;this.icon=null;this.visibleElements=new x;this._defaultViewModel=null;this._timeSlider=new B({...R,container:document.createElement("div")});
this._tooltip=null;this._onTimezoneChange=c=>{this.viewModel.utcOffset=c};this._onDateChange=c=>{this.viewModel.date=c};a?.viewModel||(this.viewModel=this._defaultViewModel=new E({view:a?.view}))}initialize(){this.addHandles([l.watch(()=>({viewModel:this.viewModel,slider:this._timeSlider}),a=>this._connectTimeSlider(a),l.syncAndInitial),l.watch(()=>({container:this.view?.surface,viewModel:this.viewModel,tooltipVisible:this.visibleElements.tooltip}),({container:a,viewModel:b,tooltipVisible:c})=>{this._tooltip=
v.destroyMaybe(this._tooltip);null!=a&&c&&(this._tooltip=new H.ShadowTooltip({viewModel:b,container:a}))},l.syncAndInitial),l.watch(()=>({viewModel:this.viewModel,visible:this.visible}),({viewModel:a,visible:b})=>a.setRunning(b),l.syncAndInitial)])}destroy(){this._timeSlider=v.destroyMaybe(this._timeSlider);null!=this._defaultViewModel&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}loadDependencies(){return J.loadCalciteComponents({select:()=>new Promise((a,b)=>u(["../chunks/calcite-select"],
a,b)),option:()=>new Promise((a,b)=>u(["../chunks/calcite-option"],a,b))})}render(){const {visibleElements:a,viewModel:b}=this;return d.tsx("div",{class:this.classes(m.css.base,q.globalCss.widget,q.globalCss.panel,{[q.globalCss.widgetDisabled]:b.state===D.ShadowCastState.Disabled}),key:this},this._renderTimeRangeSection(),a.visualizationOptions?this._renderVisualizationOptionsSection():null)}get view(){return this.viewModel?.view}set view(a){this.viewModel&&(this.viewModel.view=a)}get label(){return this.messages?.widgetLabel??
""}set label(a){this._overrideIfSome("label",a)}get testData(){return{tooltip:this._tooltip}}_connectTimeSlider({viewModel:a,slider:b}){this.removeHandles(t.Slider);if(null!=b){var c=f=>w.convertTime(f,"milliseconds","minutes"),k=f=>w.convertTime(f,"minutes","milliseconds"),n=({index:f,value:r})=>{0===f?a.startTimeOfDay=k(r):a.endTimeOfDay=k(r)};this.addHandles([l.watch(()=>[a.startTimeOfDay,a.endTimeOfDay],f=>{b.values=f.map(c)},l.syncAndInitial),b.on("thumb-change",n),b.on("thumb-drag",n),b.on("segment-drag",
()=>{[a.startTimeOfDay,a.endTimeOfDay]=b.values.map(k)})],t.Slider)}}_renderTimeRangeSection(){const {visibleElements:a}=this;return a.timeRangeSlider||a.datePicker?d.tsx("section",{class:m.css.timeRange,key:"time-range"},d.tsx(y.Heading,{level:this.headingLevel},this.messages.timeLabel),a.timeRangeSlider?this._renderTimeRange():null,a.datePicker?this._renderDatePicker():null):null}_renderTimeRange(){const {messages:a,viewModel:b,visibleElements:c}=this,{startTimeOfDay:k,endTimeOfDay:n}=b,[f,r]=[k,
n].map(S=>O.formatDate(new Date(S),P));return[d.tsx("div",{class:m.css.timeRangeIndicator,key:"time-range-indicator"},A.substitute(a.timeRange,{start:f,end:r}),c.timezone?d.tsx(M.TimezonePicker,{value:b.utcOffset,onChange:this._onTimezoneChange}):null),d.tsx("div",{afterCreate:this._timeSliderContainerAfterCreate,afterRemoved:this._timeSliderContainerAfterRemoved,bind:this,key:"time-slider-container"})]}_timeSliderContainerAfterCreate(a){const b=this._timeSlider?.container;b&&a.appendChild(b)}_timeSliderContainerAfterRemoved(a){const b=
this._timeSlider?.container;b&&a.removeChild(b)}_renderDatePicker(){return d.tsx("div",{class:m.css.datePickerContainer,key:"date-picker"},d.tsx(K,{value:this.viewModel.date,onChange:this._onDateChange}))}_renderVisualizationOptionsSection(){const {headingLevel:a,messages:b,viewModel:c,visibleElements:k}=this,n=k.colorPicker,f=r=>this.classes(c.visualizationType===r?null:m.css.visualizationConfigHidden);return d.tsx("section",{class:m.css.visualization,key:"visualization"},d.tsx(y.Heading,{level:a},
b.visualizationLabel),this._renderVisualizationSelect(),d.tsx("div",{class:f(p.ShadowVisualizationType.Threshold),key:"threshold-configurator"},d.tsx(I.ThresholdConfigurator,{colorPickerVisible:n,options:c.thresholdOptions})),d.tsx("div",{class:f(p.ShadowVisualizationType.Duration),key:"duration-configurator"},d.tsx(G.DurationConfigurator,{colorPickerVisible:n,options:c.durationOptions})),d.tsx("div",{class:f(p.ShadowVisualizationType.Discrete),key:"discrete-configurator"},d.tsx(F.DiscreteConfigurator,
{colorPickerVisible:n,options:c.discreteOptions})))}_renderVisualizationSelect(){const a=this.messages,b=this.viewModel.visualizationType;return d.tsx("calcite-select",{bind:this,class:m.css.visualizationSelect,key:"visualization-select",label:a.visualizationLabel,onCalciteSelectChange:this._onVisualizationTypeChange},[{type:p.ShadowVisualizationType.Threshold,label:a.threshold.label},{type:p.ShadowVisualizationType.Duration,label:a.duration.label},{type:p.ShadowVisualizationType.Discrete,label:a.discrete.label}].map(({type:c,
label:k})=>d.tsx("calcite-option",{selected:c===b,value:c},k)))}_onVisualizationTypeChange(a){this.viewModel.visualizationType=a.target.selectedOption?.value??p.ShadowVisualizationType.Threshold}};g.__decorate([h.property()],e.prototype,"viewModel",void 0);g.__decorate([h.property()],e.prototype,"view",null);g.__decorate([h.property()],e.prototype,"headingLevel",void 0);g.__decorate([h.property()],e.prototype,"iconClass",void 0);g.__decorate([h.property()],e.prototype,"icon",void 0);g.__decorate([h.property()],
e.prototype,"label",null);g.__decorate([h.property({type:x,nonNullable:!0})],e.prototype,"visibleElements",void 0);g.__decorate([h.property(),N.messageBundle("esri/widgets/ShadowCast/t9n/ShadowCast")],e.prototype,"messages",void 0);g.__decorate([h.property()],e.prototype,"_defaultViewModel",void 0);g.__decorate([h.property()],e.prototype,"_timeSlider",void 0);g.__decorate([h.property()],e.prototype,"_tooltip",void 0);return e=g.__decorate([z.subclass("esri.widgets.ShadowCast")],e)});