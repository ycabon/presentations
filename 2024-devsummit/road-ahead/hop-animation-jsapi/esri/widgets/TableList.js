// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../core/Collection ../core/deprecate ../core/Logger ../core/accessorSupport/decorators/property ../core/has ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../support/actions/actionUtils ./Widget ./LayerList/support/layerListUtils ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ./TableList/css ./TableList/ListItem ./TableList/TableListViewModel ./TableList/TableListVisibleElements ./TableList/support/tableListUtils".split(" "),
function(t,f,e,x,y,g,N,O,G,A,H,B,I,z,P,D,J,h,r,K,E,F,v){const L=e.ofType(K);e=class extends H{constructor(a,b){super(a,b);this._focusPanelFlowItem=this._focusRootFlowItem=!1;this._selectedDragItemLayerUid=this._lastDragDetail=null;this.dragEnabled=this.collapsed=!1;this.filterText=this.filterPlaceholder="";this.headingLevel=2;this.icon=null;this.iconClass=r.css.widgetIcon;this.messagesCommon=this.messages=this.listItemCanReceiveFunction=this.listItemCanGiveFunction=null;this.selectedItems=new L;this.selectionMode=
"none";this.viewModel=new E;this.visibleElements=new F;this._canMove=({dragEl:c,fromEl:d,toEl:m},k)=>{k="pull"===k?this.listItemCanGiveFunction:this.listItemCanReceiveFunction;c=v.getItem(c);if(!c?.sortable)return!1;const n=v.getItem(d);var l=B.getLayerType(d);const p=v.getItem(m),u=B.getLayerType(m);l=!!l&&!!u&&l===u;c={selected:c,from:n,to:p};return d.group&&m.group&&"function"===typeof k?k.call(null,c):l};this._onCalciteListOrderChange=c=>{const {_lastDragDetail:d,tableItems:m}=this,{toEl:k,fromEl:n,
dragEl:l,oldIndex:p,newIndex:u}=c;if(n&&k&&(d?.newIndex!==u||d?.dragEl!==l||d?.toEl!==k||d?.fromEl!==n)&&(this._lastDragDetail=c,c=v.getItem(l))){c=c.layer.uid;var w=m.map(C=>C.layer.uid).toArray();w.splice(p,1);w.splice(u,0,c);v.sortTablesToIds(this.map?.tables,w)}}}loadDependencies(){return I.loadCalciteComponents({action:()=>new Promise((a,b)=>t(["../chunks/calcite-action"],a,b)),"action-group":()=>new Promise((a,b)=>t(["../chunks/calcite-action-group"],a,b)),"action-menu":()=>new Promise((a,b)=>
t(["../chunks/calcite-action-menu"],a,b)),button:()=>new Promise((a,b)=>t(["../chunks/calcite-button"],a,b)),flow:()=>new Promise((a,b)=>t(["../chunks/calcite-flow"],a,b)),"flow-item":()=>new Promise((a,b)=>t(["../chunks/calcite-flow-item"],a,b)),icon:()=>new Promise((a,b)=>t(["../chunks/calcite-icon"],a,b)),list:()=>new Promise((a,b)=>t(["../chunks/calcite-list"],a,b)),"list-item":()=>new Promise((a,b)=>t(["../chunks/calcite-list-item"],a,b)),notice:()=>new Promise((a,b)=>t(["../chunks/calcite-notice"],
a,b))})}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",a)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(a){this.viewModel.listItemCreatedFunction=a}get map(){return this.viewModel.map}set map(a){this.viewModel.map=a}get multipleSelectionEnabled(){x.deprecatedProperty(y.getLogger(this),"multipleSelectionEnabled",{replacement:"selectionMode",version:"4.29",warnOnce:!0});return"multiple"===this.selectionMode}set multipleSelectionEnabled(a){x.deprecatedProperty(y.getLogger(this),
"multipleSelectionEnabled",{replacement:"selectionMode",version:"4.29",warnOnce:!0});this.selectionMode=a?"multiple":this.selectionEnabled?"single":"none"}get selectionEnabled(){x.deprecatedProperty(y.getLogger(this),"selectionEnabled",{replacement:"selectionMode, dragEnabled",version:"4.29",warnOnce:!0});return"none"!==this.selectionMode&&this.dragEnabled}set selectionEnabled(a){x.deprecatedProperty(y.getLogger(this),"selectionEnabled",{replacement:"selectionMode, dragEnabled",version:"4.29",warnOnce:!0});
this.selectionMode=(this.dragEnabled=a)?this.multipleSelectionEnabled?"multiple":"single":"none"}get tableItems(){return this.viewModel.tableItems}triggerAction(a,b){return this.viewModel.triggerAction(a,b)}render(){var a=this.viewModel?.state;a={[z.globalCss.hidden]:"loading"===a,[z.globalCss.disabled]:"disabled"===a};const b=this.tableItems?.filter(c=>!c.hidden&&(this.visibleElements.errors||!c.error));return h.tsx("div",{class:this.classes(r.css.base,z.globalCss.widget,z.globalCss.panel,a)},b?.length?
this._renderItems(b):this._renderNoItems())}_renderNoItemsMessage(){return h.tsx("div",{slot:"message"},this.messages.noItemsToDisplay)}_renderNoItems(){return h.tsx("div",{class:r.css.itemMessage,key:"esri-layer-list__no-items"},h.tsx("calcite-notice",{icon:"information",kind:"info",open:!0,scale:"m",width:"full"},this._renderNoItemsMessage()))}_renderPanelFlowItems(a){return a?.toArray().filter(({panel:b})=>b?.open&&!b.disabled&&b.flowEnabled).map(({title:b,panel:c})=>{const d=()=>this._handlePanelFlowItemBack(c);
return h.tsx("calcite-flow-item",{afterCreate:this._focusPanelFlowItemNode,afterUpdate:this._focusPanelFlowItemNode,bind:this,description:b,heading:c.title,headingLevel:this.headingLevel,key:`flow-panel-${c.uid}`,onCalciteFlowItemBack:m=>{m.preventDefault();d()}},c.render(),h.tsx("calcite-button",{appearance:"transparent",onclick:d,slot:"footer-actions",width:"full"},this.messagesCommon.back))})}_handlePanelFlowItemBack(a){a.open=!1;this._focusRootFlowItem=!0}_focusRootFlowItemNode(a){this._focusRootFlowItem&&
(this._focusRootFlowItem=!1,requestAnimationFrame(()=>a?.setFocus()))}_focusPanelFlowItemNode(a){this._focusPanelFlowItem&&(this._focusPanelFlowItem=!1,requestAnimationFrame(()=>a?.setFocus()))}_renderItems(a){const {visible:b,collapsed:c,visibleElements:{closeButton:d,collapseButton:m,filter:k,heading:n,flow:l},dragEnabled:p,selectionMode:u,messages:w,filterPlaceholder:C,filterText:M}=this;a=[h.tsx("calcite-flow-item",{afterCreate:this._focusRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,
bind:this,closable:d,closed:!b,collapsed:c,collapsible:m,heading:n?w.widgetLabel:void 0,headingLevel:this.headingLevel,key:"root-flow-item",onCalciteFlowItemClose:()=>this.visible=!1},h.tsx("calcite-list",{canPull:q=>this._canMove(q,"pull"),canPut:q=>this._canMove(q,"put"),"data-layer-type":"table",dragEnabled:p,filterEnabled:k,filterPlaceholder:C,filterText:M,group:B.sortableRoot,key:"root-list",label:w.widgetLabel,selectionAppearance:"border",selectionMode:u,onCalciteListChange:q=>this._handleCalciteListChange(q),
onCalciteListDragEnd:q=>this._handleCalciteListDragEnd(q.detail),onCalciteListFilter:q=>this.filterText=q.target?.filterText??"",onCalciteListOrderChange:q=>this._onCalciteListOrderChange(q.detail)},a?.toArray().map(q=>this._renderItem(q)),h.tsx("div",{class:r.css.filterNoResults,slot:"filter-no-results"},h.tsx("calcite-notice",{kind:"info",open:!0,scale:"m",width:"full"},this._renderNoItemsMessage())))),this._renderPanelFlowItems(a)];return b?l?h.tsx("calcite-flow",{key:"root-flow"},a):a:null}_handleCalciteListDragEnd(a){const {fromEl:b,
dragEl:c,oldIndex:d}=a;b.insertBefore(c,b.children[d])}_renderItemMessage(a){return a.error?h.tsx("div",{class:r.css.itemMessage,key:"esri-layer-list__error",slot:"content-bottom"},h.tsx("calcite-notice",{icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",width:"full"},h.tsx("div",{slot:"message"},this.messages.tableError))):null}_renderItem(a){const {_selectedDragItemLayerUid:b,selectionMode:c,selectedItems:d,messages:m}=this,k=a.title||m.untitledTable,n=this._filterActions(a.actionsSections),
l=this._countActions(n);return h.tsx("calcite-list-item",{afterCreate:p=>this._focusSelectedDragEl(p,a),afterUpdate:p=>this._focusSelectedDragEl(p,a),class:r.css.item,"data-item":a,dragDisabled:!a.sortable,dragSelected:a.layer.uid===b,id:a.layer?.uid,key:`list-item-${a.layer.uid}`,selected:"none"!==c?d.includes(a):!1,title:k,value:k,onCalciteListItemDragHandleChange:p=>this._handleCalciteListItemDragHandleChange(p,a)},h.tsx("div",{class:r.css.itemContent,slot:"content"},k),this._renderItemStatus(a),
this._renderItemMessage(a),this._renderPanel(a.panel),this._renderPanelAction(a.panel),1<l?this._renderActionsSections(a,n):1===l?this._renderAction({item:a,action:this._getSingleActionButton(n),textEnabled:!1}):null)}_renderItemStatus(a){const {visibleElements:b}=this;if(!b.statusIndicators)return null;({publishing:a}=a);return h.tsx("calcite-icon",{class:this.classes({[r.css.publishing]:a}),icon:a?"stop-square":"blank",key:"layer-item-status",scale:"s",slot:"actions-end"})}_renderPanel(a){return!a?.open||
a.disabled||a.flowEnabled?null:h.tsx("div",{class:r.css.itemContentBottom,key:`content-panel-${a.uid}`,slot:"content-bottom"},a.render())}_renderPanelAction(a){if(!a?.visible)return null;const {open:b,title:c,disabled:d}=a;return h.tsx("calcite-action",{active:b,appearance:"transparent",disabled:d,icon:A.getActionIcon(a),key:`action-${a.uid}`,onclick:()=>this._togglePanel(a),scale:"s",slot:"actions-end",text:c??"",title:c??void 0},this._renderFallbackIcon(a))}_renderActionsSections(a,b){return h.tsx("calcite-action-menu",
{appearance:"transparent",key:"item-action-menu",label:this.messagesCommon.menu,open:a.actionsOpen,overlayPositioning:"fixed",placement:"bottom-end",scale:"s",slot:"actions-end",onCalciteActionMenuOpen:c=>a.actionsOpen=c.target.open},b.toArray().map((c,d)=>this._renderActionSection(a,c,d)))}_renderActionSection(a,b,c){return h.tsx("calcite-action-group",{key:`action-section-${c}`},b.toArray().map(d=>this._renderAction({item:a,action:d,textEnabled:!0})))}_renderFallbackIcon(a){const {className:b,icon:c}=
a;if(c)return null;a="image"in a?a.image:void 0;const d={[r.css.itemActionIcon]:!!b,[r.css.itemActionImage]:!!a};b&&(d[b]=!0);return a||b?h.tsx("span",{"aria-hidden":"true",class:this.classes(r.css.itemActionIcon,d),key:"icon",styles:A.getActionStyles(a)}):null}_renderAction(a){const {item:b,action:c,textEnabled:d}=a,{active:m,disabled:k,title:n,type:l,indicator:p}=c;return h.tsx("calcite-action",{active:"toggle"===l?c.value:!1,appearance:"transparent",disabled:k,icon:A.getActionIcon(c),indicator:p,
key:`action-${c.uid}`,loading:m,onclick:()=>this._triggerAction(b,c),scale:"s",slot:d?void 0:"actions-end",text:n??"",textEnabled:d,title:n??void 0},this._renderFallbackIcon(c))}_filterActions(a){return a.map(b=>b.filter(c=>c.visible))}_getSingleActionButton(a){return a.reduce(b=>b).filter(b=>b&&"button"===b.type).at(0)}_countActions(a){return a.reduce((b,c)=>b+c.length,0)}_focusSelectedDragEl(a,b){this._selectedDragItemLayerUid===b.layer.uid&&requestAnimationFrame(()=>a?.setFocus())}_handleCalciteListItemDragHandleChange(a,
b){a.stopPropagation();this._selectedDragItemLayerUid=a.target.dragSelected?b.layer.uid:null}_handleCalciteListChange(a){const {selectionMode:b,selectedItems:c}=this;"none"!==b&&(a=a.target.selectedItems.map(d=>v.getItem(d)).filter(Boolean),c.removeAll(),c.addMany(a))}_togglePanel(a){a.open=!a.open;a.open&&(this._focusPanelFlowItem=!0)}_triggerAction(a,b){b&&a&&("toggle"===b.type&&(b.value=!b.value),this.triggerAction(b,a))}};f.__decorate([g.property()],e.prototype,"_focusRootFlowItem",void 0);f.__decorate([g.property()],
e.prototype,"_focusPanelFlowItem",void 0);f.__decorate([g.property()],e.prototype,"collapsed",void 0);f.__decorate([g.property()],e.prototype,"dragEnabled",void 0);f.__decorate([g.property()],e.prototype,"filterPlaceholder",void 0);f.__decorate([g.property()],e.prototype,"filterText",void 0);f.__decorate([g.property()],e.prototype,"headingLevel",void 0);f.__decorate([g.property()],e.prototype,"icon",void 0);f.__decorate([g.property()],e.prototype,"iconClass",void 0);f.__decorate([g.property()],e.prototype,
"label",null);f.__decorate([g.property()],e.prototype,"listItemCanGiveFunction",void 0);f.__decorate([g.property()],e.prototype,"listItemCanReceiveFunction",void 0);f.__decorate([g.property()],e.prototype,"listItemCreatedFunction",null);f.__decorate([g.property()],e.prototype,"map",null);f.__decorate([g.property(),D.messageBundle("esri/widgets/TableList/t9n/TableList")],e.prototype,"messages",void 0);f.__decorate([g.property(),D.messageBundle("esri/t9n/common")],e.prototype,"messagesCommon",void 0);
f.__decorate([g.property()],e.prototype,"multipleSelectionEnabled",null);f.__decorate([g.property()],e.prototype,"selectionEnabled",null);f.__decorate([g.property()],e.prototype,"selectedItems",void 0);f.__decorate([g.property()],e.prototype,"selectionMode",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"tableItems",null);f.__decorate([J.vmEvent("trigger-action"),g.property({type:E})],e.prototype,"viewModel",void 0);f.__decorate([g.property({type:F,nonNullable:!0})],e.prototype,"visibleElements",
void 0);return e=f.__decorate([G.subclass("esri.widgets.TableList")],e)});