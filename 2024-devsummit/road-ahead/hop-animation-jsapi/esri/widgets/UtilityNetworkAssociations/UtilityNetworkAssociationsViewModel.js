// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../Graphic ../../intl ../../core/Accessor ../../core/Collection ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/support/UpdatingHandles ../../geometry/Extent ../../geometry/Point ../../geometry/projection ../../layers/GraphicsLayer ../../symbols/LineSymbolMarker ../../symbols/SimpleLineSymbol ../../views/draw/support/layerUtils ../../intl/locale ../../intl/messages".split(" "),
function(d,x,c,D,E,y,z,n,f,N,O,F,G,H,A,q,I,p,r,B,J,K){c=class extends D{constructor(b){super(b);this._internalGraphicsLayerConnectivity=this._createInternalGraphicsLayer("Connectivity Associations (Internal)");this._internalGraphicsLayerStructuralAttachment=this._createInternalGraphicsLayer("Structural Attachment Associations (Internal)");this._initialValidationsFinished=!1;this._updatingHandles=new G.UpdatingHandles;this.autoRefreshAssociations=!1;this.connectivityAssociationsLineSymbol=new r({style:"short-dash",
width:2,color:[190,159,159,1]});this.executionError="";this.loadErrors=new E;this.maxAllowableAssociations=250;this.showArrowsStructuralAttachment=this.showArrowsConnectivity=this.showAssociationsEnabled=!1;this.structuralAttachmentAssociationsLineSymbol=new r({style:"short-dash",width:2,color:[159,190,159,1]})}initialize(){const b=async()=>{this.messages||(this.messages=await K.fetchMessageBundle("esri/widgets/UtilityNetworkAssociations/t9n/UtilityNetworkAssociations"))};b().then(()=>{this.view||
(this.view=null);this.utilityNetwork||(this.utilityNetwork=null);this.addHandles([n.watch(()=>[this.view,this.utilityNetwork],async()=>{const {loadErrors:a,messages:{info:{noUtilityNetwork:e,noView:g}}}=this;this._initialValidationsFinished=!1;a.removeAll();let h=!1,k=!1;this.removeAssociations();"utility"!==this.utilityNetwork?.type?(this.loadErrors.push(e),z.getLogger(this).error(new y("utilityNetworkAssociations:missing-property",e))):(this.utilityNetwork.loaded||await this.utilityNetwork.load(),
h=!0);"2d"!==this.view?.type?(this.loadErrors.push(g),z.getLogger(this).error(new y("utilityNetworkAssociations:missing-property",g))):(B.addUniqueLayer(this.view,this._internalGraphicsLayerConnectivity),B.addUniqueLayer(this.view,this._internalGraphicsLayerStructuralAttachment),k=!0);h&&k&&this.showAssociationsEnabled&&await this.showAssociations();this._internalGraphicsLayerConnectivity.visible=this.includeConnectivityAssociations;this._internalGraphicsLayerStructuralAttachment.visible=this.includeStructuralAttachmentAssociations;
this._initialValidationsFinished=!0},{initial:!0}),n.watch(()=>[this.view?.stationary,this.showAssociationsEnabled,this.maxAllowableAssociations],async()=>{this.view?.stationary&&this.showAssociationsEnabled&&(this.includeConnectivityAssociations||this.includeStructuralAttachmentAssociations)&&await this.showAssociations()}),n.watch(()=>[this.showArrowsConnectivity],()=>{const a=this.connectivityAssociationsLineSymbol.clone();a.marker=null;this.showArrowsConnectivity&&(a.marker=new p({color:this.connectivityAssociationsLineSymbol.color,
placement:"end",style:"arrow"}));for(const e of this._internalGraphicsLayerConnectivity.graphics)e.symbol=a}),n.watch(()=>[this.showArrowsStructuralAttachment],()=>{const a=this.structuralAttachmentAssociationsLineSymbol.clone();a.marker=null;this.showArrowsStructuralAttachment&&(a.marker=new p({color:this.structuralAttachmentAssociationsLineSymbol.color,placement:"end",style:"arrow"}));for(const e of this._internalGraphicsLayerStructuralAttachment.graphics)e.symbol=a}),n.watch(()=>{const {cap:a,
color:e,style:g,width:h,marker:k}=this.connectivityAssociationsLineSymbol;return[a,e,g,h,k]},()=>{const a=this.connectivityAssociationsLineSymbol.clone();for(const e of this._internalGraphicsLayerConnectivity.graphics)e.symbol=a;this.showArrowsConnectivity=!1;a.marker=null;this.connectivityAssociationsLineSymbol.marker&&(this.showArrowsConnectivity=!0,a.marker=new p({color:this.connectivityAssociationsLineSymbol.color,placement:"end",style:"arrow"}))}),n.watch(()=>{const {cap:a,color:e,style:g,width:h,
marker:k}=this.structuralAttachmentAssociationsLineSymbol;return[a,e,g,h,k]},()=>{const a=this.structuralAttachmentAssociationsLineSymbol.clone();for(const e of this._internalGraphicsLayerStructuralAttachment.graphics)e.symbol=a;this.showArrowsStructuralAttachment=!1;a.marker=null;this.structuralAttachmentAssociationsLineSymbol.marker&&(this.showArrowsStructuralAttachment=!0,a.marker=new p({color:this.structuralAttachmentAssociationsLineSymbol.color,placement:"end",style:"arrow"}))}),J.onLocaleChange(b)])})}destroy(){this._updatingHandles.destroy();
this.view=null;this._removeInternalGraphicsLayers()}set includeConnectivityAssociations(b){this._set("includeConnectivityAssociations",b);this._internalGraphicsLayerConnectivity.visible=b}set includeStructuralAttachmentAssociations(b){this._set("includeStructuralAttachmentAssociations",b);this._internalGraphicsLayerStructuralAttachment.visible=b}get state(){return this.loadErrors.length?"disabled":this._updatingHandles.updating?"executing":""!==this.executionError?"warning":this._initialValidationsFinished?
"ready":"loading"}set utilityNetwork(b){this._get("utilityNetwork")!==b&&this._set("utilityNetwork",b)}set view(b){this._get("view")!==b&&this._set("view",b)}removeAssociations(){this._internalGraphicsLayerConnectivity.removeAll();this._internalGraphicsLayerStructuralAttachment.removeAll()}async showAssociations(){const {messages:{info:{maxAllowableAssociationsExceeded:b,noAssociationsFound:a}},utilityNetwork:e}=this,{spatialReference:g,extent:{xmin:h,ymin:k,xmax:L,ymax:M}}=this.view,t=e?.spatialReference;
q.isLoaded()||await q.load();var u=q.project(new A({x:h,y:k,spatialReference:g}),t);const C=q.project(new A({x:L,y:M,spatialReference:g}),t);u=new H({xmin:u.x,ymin:u.y,xmax:C.x,ymax:C.y,spatialReference:t});this._set("executionError","");this.removeAssociations();this._updatingHandles.addPromise(e?.synthesizeAssociationGeometries({returnConnectivityAssociations:this.includeConnectivityAssociations,returnAttachmentAssociations:this.includeStructuralAttachmentAssociations,extent:u,outSpatialReference:t,
maxGeometryCount:this.maxAllowableAssociations}).then(l=>{let v=[],w=[];l?.maxGeometryCountExceeded?this._set("executionError",b):0===l?.associations.length?this._set("executionError",a):l&&(v=l?.associations.filter(({associationType:m})=>"connectivity"===m).map(m=>{this.connectivityAssociationsLineSymbol.marker=null;this.showArrowsConnectivity&&(this.connectivityAssociationsLineSymbol.marker=new p({color:this.connectivityAssociationsLineSymbol.color,placement:"end",style:"arrow"}));return new x({geometry:m.geometry.clone(),
symbol:this.connectivityAssociationsLineSymbol})}),w=l.associations.filter(({associationType:m})=>"attachment"===m).map(m=>{this.structuralAttachmentAssociationsLineSymbol.marker=null;this.showArrowsStructuralAttachment&&(this.structuralAttachmentAssociationsLineSymbol.marker=new p({color:this.structuralAttachmentAssociationsLineSymbol.color,placement:"end",style:"arrow"}));return new x({geometry:m.geometry.clone(),symbol:this.structuralAttachmentAssociationsLineSymbol})}),0<v.length&&this._internalGraphicsLayerConnectivity.addMany(v),
0<w.length&&this._internalGraphicsLayerStructuralAttachment.addMany(w))},({message:l})=>{this._set("executionError",l)}))}_createInternalGraphicsLayer(b){return new I({listMode:"hide",internal:!0,title:b})}_removeInternalGraphicsLayers(){this._internalGraphicsLayerConnectivity&&this._internalGraphicsLayerStructuralAttachment&&this.view?.map&&(this.view.map.remove(this._internalGraphicsLayerConnectivity),this.view.map.remove(this._internalGraphicsLayerStructuralAttachment))}};d.__decorate([f.property()],
c.prototype,"_initialValidationsFinished",void 0);d.__decorate([f.property()],c.prototype,"autoRefreshAssociations",void 0);d.__decorate([f.property({type:r,nonNullable:!0})],c.prototype,"connectivityAssociationsLineSymbol",void 0);d.__decorate([f.property({readOnly:!0})],c.prototype,"executionError",void 0);d.__decorate([f.property({type:Boolean,value:!0})],c.prototype,"includeConnectivityAssociations",null);d.__decorate([f.property({type:Boolean,value:!0})],c.prototype,"includeStructuralAttachmentAssociations",
null);d.__decorate([f.property()],c.prototype,"loadErrors",void 0);d.__decorate([f.property()],c.prototype,"maxAllowableAssociations",void 0);d.__decorate([f.property()],c.prototype,"messages",void 0);d.__decorate([f.property()],c.prototype,"showAssociationsEnabled",void 0);d.__decorate([f.property()],c.prototype,"showArrowsConnectivity",void 0);d.__decorate([f.property()],c.prototype,"showArrowsStructuralAttachment",void 0);d.__decorate([f.property({readOnly:!0})],c.prototype,"state",null);d.__decorate([f.property({type:r,
nonNullable:!0})],c.prototype,"structuralAttachmentAssociationsLineSymbol",void 0);d.__decorate([f.property()],c.prototype,"utilityNetwork",null);d.__decorate([f.property()],c.prototype,"view",null);return c=d.__decorate([F.subclass("esri.widgets.UtilityNetworkAssociations.UtilityNetworkAssociationsViewModel")],c)});