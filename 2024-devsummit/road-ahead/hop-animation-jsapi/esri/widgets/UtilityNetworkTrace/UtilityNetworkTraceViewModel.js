// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../kernel ../../core/Collection ../../core/Error ../../core/Evented ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../intl/messages ../../layers/FeatureLayer ../../layers/GraphicsLayer ../../layers/support/CodedValueDomain ../../layers/support/layerUtils ../../networks/UtilityNetwork ../../networks/support/utils ../../portal/Portal ../../portal/support/utils ../../rest/networks/trace ../../rest/networks/support/TraceLocation ../../rest/networks/support/TraceParameters ./support/GeometryHandler ./support/GraphicHandler ./support/ResultAreaHandler ./support/UtilityHelper".split(" "),
function(k,w,x,t,h,y,z,l,R,S,A,B,u,C,D,E,F,G,r,H,I,J,v,K,L,M,N,O){async function P(a){var b=new C({url:a.networkSystemLayers.dirtyAreasLayerUrl});await b.load();return 11.1>=Number(b.version)?(a=new H({url:(new URL(a.layerUrl)).origin+"/portal"}),await a.load(),(b=a?.user?.username)?I.hasUserTypeExtension(a,b,"utilityNetwork"):!1):!0}const n=`utility-network-trace-flags-${Date.now()}`,p=`utility-network-trace-results-${Date.now()}`;h=class extends h.EventedAccessor{constructor(a){super(a);this._activeProgress=
!1;this._clickHandler=null;this._flags=[];this._geometryHandler=null;this._highlightHandler=[];this._resultAreaHandler=null;this._utilityHelper=new O.UtilityHelper;this._traces=[];this._watchHandler=null;this._validUNLayers=[];this._traceTimeout=6E5;this.graphicHandler=null;this.defaultGraphicColor={color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#FFFF00"};this.enableResultArea=!1;this.flags=[];this.gdbVersion="sde.DEFAULT";this.messagesUnits=this.messages=null;this.defaultResultAreaProperties=
{type:"convexhull",distance:10,unit:"meters",areaUnit:"square-meters",color:{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},show:!1};this.selectedTraces=[];this.showSelectionAttributes=this.showGraphicsOnComplete=this.selectOnComplete=!0;this.traceResults=[];this.utilityNetwork=null}initialize(){this._geometryHandler=new L.GeometryHandler;this.graphicHandler=new M.GraphicHandler;this._resultAreaHandler=new N.ResultAreaHandler;(async()=>{const [a,b]=await Promise.all([u.fetchMessageBundle("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"),
u.fetchMessageBundle("esri/core/t9n/Units")]);this.set({messages:a,messagesUnits:b})})()}destroy(){this.view=null}get resultAreaProperties(){return this.defaultResultAreaProperties}set resultAreaProperties(a){this._set("resultAreaProperties",{...this.defaultResultAreaProperties,...a});this.graphicHandler.addCustomColor(this.resultAreaProperties.color);this.traceResults.forEach(b=>{b.resultArea={...this.defaultResultAreaProperties,...a};const c=b.resultArea.show;this.removeResultAreaFromMap(b);c&&
this.enableResultArea&&this.addResultAreaToMap(b)})}get state(){return this.view?.ready?"ready":"loading"}get view(){return this._get("view")}set view(a){a&&"2d"!==a.type&&y.getLogger(this).error(new t("view:invalid-view","SceneView is not supported",{view:a}));this._set("view",a)}addFlagByHit(a,b){const c=d=>{this.view?.popup&&(this.view.popupEnabled=d)};return new Promise((d,e)=>{c(!1);this._clickHandler?.remove();this.emit("add-flag",{type:a});this._clickHandler=this.view?.on("click",f=>{this.queryFlagByHitTest(f,
a,b).then(g=>{c(!0);this._clickHandler?.remove();this.emit("add-flag-complete",{type:a,symbol:b});d(g)}).catch(g=>{c(!0);this._clickHandler?.remove();this.emit("add-flag-error",{type:a,symbol:b});e(g)})})})}async addFlagsOnLoad(){return new Promise(a=>{const b=[];this._watchHandler=z.when(()=>null!=this.view&&!this.view.updating,async()=>{if(!(0<this._flags.length)){const c=this.flags.map(async d=>{if(d.mapPoint){var e=new B({x:d.mapPoint.x,y:d.mapPoint.y,spatialReference:d.mapPoint.spatialReference.wkid});
e={screenPoint:this.view.toScreen(e),mapPoint:e};await this.queryFlagByHitTest(e,d.type)||("barrier"===d.type?b.push("barrier"):b.push("starting-point"))}});await Promise.all(c)}a(b)},{initial:!0})})}addResultAreaToMap(a){a.resultArea.show=!0;if(null!==a.results?.aggregatedGeometry){var b=this._geometryHandler.mergeAggregatedToGeometries(a.results?.aggregatedGeometry);if(0<b.length){var c=Array(b.length).fill(a.resultArea?.distance);this.createResultAreaGeometries(a,b,c)}}else{b=this._groupResultsByNetworkSource(a.results.elements);
c=[];for(const d in b)c.push(this.queryFeaturesById(b[d]));Promise.all(c).then(d=>{const e=[];for(const f of d)for(const g of f)for(const m of g.featureSet.features)e.push(m.geometry);d=Array(e.length).fill(a.resultArea?.distance);this.createResultAreaGeometries(a,e,d)}).catch(d=>{console.log(d)})}}async addResultGraphicToView(a,b){const {view:c}=this,{results:d}=a;if(c&&d)for(const f in d.aggregatedGeometry)if("line,multipoint,polygon".includes(f)){var e=d.aggregatedGeometry[f];if(null!=e){e.spatialReference=
this.utilityNetwork.spatialReference;a.graphicEnabled=!0;e=await this._geometryHandler.projectGeometry(e,c.spatialReference);const g={globalid:a.trace.globalId};null!==e&&(e=this.graphicHandler.makeGraphic(e,b.color,g,c.spatialReference),this._getGraphicLayer(p)?.add(e))}}}addTerminal(a,b){const c=[...this._flags];c.forEach(d=>{d.globalId===b.globalId&&(b.selectedTerminals?.includes(parseInt(a,10))||d.selectedTerminals?.push(parseInt(a,10)))});this._flags=c}async callTrace(){const a=this._traces.filter(b=>
b.selected);return 0<a.length?(0<this.traceResults.length&&this.traceResults.forEach(b=>{this.removeResultGraphicFromView(b)}),this.traceResults=[],this.removeSelection(),await Promise.all(a.map(async(b,c)=>{const d=new K({gdbVersion:this.gdbVersion,moment:null,traceType:b.traceType,traceLocations:this._flags,namedTraceConfigurationGlobalId:b.globalId,traceConfiguration:null,outSpatialReference:null,resultTypes:null});await this.executeTrace(b,this.utilityNetwork.networkServiceUrl,d).then(e=>{if(e.hasOwnProperty("results")){var f=
{...e};if(null!==f.results){f.resultArea={...this.resultAreaProperties};e=[...f.results.elements];f.results.elements.length=0;const g=new Map;for(const m of e)g.has(m.globalId)||(g.set(m.globalId,!0),f.results.elements.push(m));e=[...this.traceResults];e.splice(c,0,f);this.traceResults=e;null!==f.results&&(this.selectOnComplete&&this.mergeSelection(!0,f.trace),this.showGraphicsOnComplete&&this.addResultGraphicToView(f,f.graphicColor),this.enableResultArea&&f.resultArea.show&&this.addResultAreaToMap(f))}else f=
[...this.traceResults],f.splice(c,0,e),this.traceResults=f;this._activeProgress=!1}else this._activeProgress=!1,f=[...this.traceResults],f.splice(c,0,e),this.traceResults=f}).catch(e=>{this._activeProgress=!1;throw e;})})),!0):!1}changeResultAreaColor(a,b){a.resultArea&&(a.resultArea.color=b,this._resultAreaHandler?.changeResultAreaColor(a.trace.globalId,b,this.view.map))}changeResultGraphicColor(a,b){const c=[...this.traceResults];0<c.length&&c.forEach(d=>{d.trace.globalId===b.trace.globalId&&(d.graphicColor=
a,d.graphicEnabled=!0)});this.traceResults=c;this.removeResultGraphicFromView(b);this.addResultGraphicToView(b,a)}changeFlagSymbol(a,b){0<this._flags.length&&this._flags.forEach(c=>{c.type===a&&b&&c.mapGraphic&&(c.mapGraphic.symbol=b)})}checkCanTrace(){const a={status:!0,issues:[]};let b=!1;const c=this._flags.some(e=>"starting-point"===e.type);var d=this._flags.filter(e=>null!==e.allTerminals);0<d.length&&(b=d.some(e=>0>=e.selectedTerminals.length));d=[];c?(d=this._traces.filter(e=>e.selected),0>=
d.length?(a.status=!1,a.issues=["noTrace"],b&&(a.status=!1,a.issues=["noTrace","noTerminalSelected"])):b&&(a.status=!1,a.issues=["noTerminalSelected"])):(d=this._traces.filter(e=>!0===e.selected),0<d.length?(a.status=!1,a.issues=["noStart"],b&&(a.status=!1,a.issues=["noStart","noTerminalSelected"])):(a.status=!1,a.issues=["noStart","noTrace"],b&&(a.status=!1,a.issues=["noStart","noTrace","noTerminalSelected"])));return a}checkSelectionExist(){return this._highlightHandler.some(a=>a)}clearResult(a){if(this.view){var b=
this.traceResults;if(0<b.length){const c=b.filter(d=>d.trace.globalId===a.globalId);0<c.length&&(this.removeResultGraphicFromView(c[0]),this.removeResultAreaFromMap(c[0]));b=b.filter(d=>d.trace.globalId!==a.globalId)}this.traceResults=b;0===b.length?(this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]})):this.mergeSelection(!1,a)}}createResultAreaGeometries(a,b,c){if(this.view&&this.resultAreaProperties){var d;"convexhull"===this.resultAreaProperties?.type?
d=this._resultAreaHandler?.createConvexHull(b,a.resultArea?.distance,a.resultArea?.unit):b&&(d=this._resultAreaHandler?.createBuffer(b,c,a.resultArea?.unit,!0));if(d&&Array.isArray(d)){if(0<d.length)for(var e of d)if(d=this.getResultAreaAttributes(a,e),d=this._resultAreaHandler?.createResultAreaGraphic(e,d,a.resultArea?.areaUnit,this.messages,this.messagesUnits,a.resultArea?.color))this._resultAreaHandler?.addResultAreaToMap(d,this.view.map),this.emit("add-result-area",{graphic:d})}else if(e=this.getResultAreaAttributes(a,
d),a=this._resultAreaHandler?.createResultAreaGraphic(d,e,a.resultArea?.areaUnit,this.messages,this.messagesUnits,a.resultArea?.color))this._resultAreaHandler?.addResultAreaToMap(a,this.view.map),this.emit("add-result-area",{graphic:a})}}executeTrace(a,b,c){const d=this._processFlags(c.traceLocations);c.traceLocations=d;return J.trace(b,c,{timeout:this._traceTimeout}).then(e=>({trace:a,results:e,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:"success",date:new Date})).catch(e=>
({trace:a,results:null,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:e.message,date:new Date}))}getResultAreaAttributes(a,b){const {messages:c}=this,d=[],e=[];this._flags.forEach(f=>{const g=f.displayValue?.field+":"+f.displayValue?.value+";"+c.attributeStrings.globalid+":"+f.globalId+";"+c.attributeStrings.terminalid+":"+f.terminalId+";"+c.attributeStrings.x+":"+f.mapPoint?.x+";"+c.attributeStrings.y+":"+f.mapPoint?.y;"starting-point"===f.type?d.push(g):e.push(g)});
return{traceId:a.trace.globalId,traceName:a.trace.title,traceDescription:a.trace.description??"",startingPoints:d.toString(),barriers:e.toString(),version:this.gdbVersion,username:w.id.credentials[0].userId,date:a.date,elementCount:a.results?.elements.length,functionResult:JSON.stringify(a.results?.globalFunctionResults),areaStatistic:b?this._geometryHandler.calculateArea(b,a.resultArea?.areaUnit):0}}getValidSources(){let a=[];const b=this.utilityNetwork.dataElement?.domainNetworks??[];for(const c of b)a=
a.concat(c.junctionSources),a=a.concat(c.edgeSources);return a}async loadUtilityNetwork(){var {view:a}=this;if(!a)return null;await a.when();if(this.utilityNetwork){this.utilityNetwork.loaded||await this.utilityNetwork.load();if(this.utilityNetwork instanceof G){try{await a.map.loadAll(),this._loadUNSupportItems()}catch(c){this._loadUNSupportItems()}return this.utilityNetwork}return null}a=a.map;const b=a.utilityNetworks?.at(0);if(b){await b.load();this.utilityNetwork=b;if(!await P(b))throw new t("utility-network:no-user-type-extension",
"User type extension not found");try{await a.loadAll(),this._loadUNSupportItems()}catch(c){}finally{this._loadUNSupportItems()}return b}return null}manageFilterBarrier(a,b){const c=[...this._flags];c.forEach(d=>{d.globalId===b.globalId&&"barrier"===b.type&&d.id===b.id&&(d.isFilterBarrier=a)});this._flags=c}mergeSelection(a,b){let c=[];const d=[...this.traceResults],e=b.globalId;d.forEach(f=>{e===f.trace.globalId&&(f.selectionEnabled=a);f.selectionEnabled&&null!==f.results?.elements&&(c=[...c,...(f.results?.elements??
[])])});this.selectResults([...(new Set(c))])}async queryFeaturesById(a){const {view:b}=this;if(!b)return null;const c=r.getObjectIdsFromElements(this.utilityNetwork,a),d={layerUrl:c[0].layerUrl,objectIds:c[0].objectIds,outFields:["*"]},e=b.map?.allTables.toArray().filter(f=>f?.parsedUrl?.path===c[0].layerUrl).filter(F.isFeatureLayer)??[];this._getUniqueMapLayerViews(b).filter(({layer:f})=>f?.parsedUrl?.path===c[0].layerUrl).forEach(({layer:f})=>{"feature"!==f.type&&"subtype-group"!==f.type||e.push(f)});
a=(await Promise.all(e.map(async f=>{f={layers:new x([f]),layerInfos:[d],returnGeometry:!0,outSpatialReference:b.spatialReference};[f]=await r.getFeaturesFromLayers(f,!1);return f}))).filter(({featureSet:f})=>0<f.features.length);return 0<a.length?a:null}queryFlagByHitTest(a,b,c){return this._lookupFlagByHit(a).then(d=>{const {view:e}=this;if(!e)return!1;if(0<d.length){const f=[...this._flags];d.forEach(g=>{g=g.graphic;const m=g.attributes.hasOwnProperty("GLOBALID")?g.attributes.GLOBALID:g.attributes.globalid;
if(0>=f.filter(Q=>Q.globalId===m).length){var q=this.graphicHandler.getFlagGraphic(g.mapPoint,b,g,c);this._getGraphicLayer(n)?.add(q);f.push({...g,type:b,globalId:g.attributes.globalid||g.attributes.GLOBALID,details:g,mapGraphic:q,id:f.length+1})}else null!==g.percentAlong&&(q=this.graphicHandler.getFlagGraphic(g.mapPoint,b,g,c),this._getGraphicLayer(n)?.add(q),f.push({...g,type:b,globalId:g.attributes.globalid||g.attributes.GLOBALID,details:g,mapGraphic:q,id:f.length+1}))});this._flags=f;return!0}return!1})}removeResultGraphicFromView(a){var {view:b}=
this;b&&(b=this._getGraphicLayer(p)?.graphics,a.graphicEnabled=!1,b?.filter(c=>c.attributes[c.attributes.hasOwnProperty("GLOBALID")?"GLOBALID":"globalid"]===a.trace.globalId)?.forEach(c=>{this._getGraphicLayer(p)?.remove(c)}))}removeFlag(a){const b=this._flags.filter(c=>{if(c.id!==a.id)return c});this._removeGraphic(a);this._flags=b}removeAllResultAreaGraphics(){this._resultAreaHandler?.removeAllResultAreaGraphics(this.view.map)}removeResultAreaFromMap(a){a.resultArea.show=!1;(a=this._resultAreaHandler?.removeResultArea(a.trace.globalId,
this.view?.map))&&this.emit("remove-result-area",{graphic:a})}removeSelection(){this._highlightHandler.forEach(a=>{a&&a.remove()});this._highlightHandler=[]}removeTerminal(a,b){const c=[...this._flags];c.forEach(d=>{if(d.globalId===b.globalId&&b.selectedTerminals?.includes(parseInt(a,10))){const e=b.selectedTerminals.indexOf(parseInt(a,10));d.selectedTerminals?.splice(e,1)}});this._flags=c}removeFlagsOnLoadWatcher(){this._watchHandler&&null!==this._watchHandler&&this._watchHandler.remove()}reset(){this._flags=
[];this.traceResults=[];const a=[...this._traces];a.forEach(b=>{b.selected=!1});this._traces=a;this.view&&(this._getGraphicLayer(p)?.removeAll(),this._getGraphicLayer(n)?.removeAll(),this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]}))}selectFeaturesById(a){const {view:b}=this;if(b){var c=r.getObjectIdsFromElements(this.utilityNetwork,a);this._getUniqueMapLayerViews(b).forEach(d=>{"layer"in d&&d.layer?.parsedUrl?.path===c[0].layerUrl&&("feature"===
d.layer.type||"subtype-group"===d.layer.type)&&this._highlightHandler.push(d.highlight(c[0].objectIds))})}}selectResults(a){if(0<a.length){this.removeSelection();a=this._groupResultsByNetworkSource(a);const b=[];for(const c in a)this.selectFeaturesById(a[c]),b.push(this.queryFeaturesById(a[c]));Promise.all(b).then(c=>{this.emit("select-features",{resultSet:c})})}else this.removeSelection(),this.emit("clear-selection",{resultSet:[]})}selectTraces(a,b){const c=[...this._traces];c.forEach(d=>{b===d.globalId&&
(d.selected=a)});this._traces=c}selectTracesOnLoad(){this.utilityNetwork.hasOwnProperty("sharedNamedTraceConfigurations")&&(this._traces=[...this.utilityNetwork.sharedNamedTraceConfigurations],this._traces.forEach(a=>{a.selected=!1;this.selectedTraces.includes(a.globalId)&&(a.selected=!0)}))}zoomToAsset(a){this.view?.goTo(a).catch(b=>console.error(b))}_loadUNSupportItems(){const {map:a}=this.view,{messages:b}=this;this._populateOutfields();this._createGraphicLayer(n);this._createGraphicLayer(p);this._resultAreaHandler?.createGraphicLayer(a,
b?.alertsStrings.genericResultHeader);this._validUNLayers=this._utilityHelper.getValidUtilityNetworkLayers(a,this.utilityNetwork)}_getUniqueMapLayerViews(a){const b=[];a.layerViews.filter(({layer:{type:c}})=>"feature"===c||"group"===c||"subtype-group"===c).toArray().forEach(c=>{switch(c.layer.type){case "group":if(void 0!==c.layerViews)for(const d of c.layerViews)b.push(d);break;case "subtype-group":b.push(c);break;default:b.some(d=>d.layer.id===c.layer.id)||b.push(c)}});return b}_processFlags(a){const b=
[];a.forEach(c=>{if(null!==c.selectedTerminals&&0<c.selectedTerminals.length)c.selectedTerminals.forEach(d=>{d=new v({globalId:c.globalId,percentAlong:c.percentAlong,terminalId:d,type:c.type,isFilterBarrier:c.isFilterBarrier});b.push(d)});else{const d=new v({globalId:c.globalId,percentAlong:c.percentAlong,terminalId:null,type:c.type,isFilterBarrier:c.isFilterBarrier});b.push(d)}});return b}_getDisplayField(a){return"subtype-sublayer"===a?.layer?.type?this._getDisplayFieldBySublayer(a):this._getDisplayFieldByFeatureLayer(a)}_getDisplayFieldBySublayer(a){let b=
"",c="";const d=a.layer;b=this._checkParentForData(d,"displayField");for(const e in a.attributes){const f=e.toLowerCase();f===b?.toLowerCase()?(c=a.attributes[e],"assetgroup"===f||"assettype"===f?c=this._checkSubtype(d,d.subtypeCode):(c=this._checkDomain(d.fields,e,c),"string"===typeof c&&(c=this._defaultDisplayField(c,d)))):(c=this._checkDomain(d.fields,e,c),"string"===typeof c&&(c=this._defaultDisplayField(c,d)))}return{field:b,value:c.toString()}}_getDisplayFieldByFeatureLayer(a){const b=a.layer;
let c=b.displayField;var d="";for(const e in a.attributes){const f=e.toLowerCase();f===c?.toLowerCase()?(d=a.attributes[e],"assetgroup"===f||"assettype"===f?((d=a.attributes[b.typeIdField.toUpperCase()])||(d=a.attributes[b.typeIdField.toLowerCase()]),c=b.typeIdField,d=this._checkSubtype(b,d),""===c&&(b.templates&&0<b.templates.length?(c=b.templates[0]?.name,d=b.templates[0]?.name):(c=b.displayField,d=a.attributes[e]))):(d=this._checkDomain(b.fields,e,d),"string"===typeof d&&(d=this._defaultDisplayField(d,
b)))):(d=this._checkDomain(b.fields,e,d),"string"===typeof d&&(d=this._defaultDisplayField(d,b)))}return{field:c,value:d?d.toString():""}}_checkSubtype(a,b){let c=b;"subtype-sublayer"===a.type?(a=this._checkParentForData(a,"subtypes"),0<a?.length&&a.forEach(d=>{d.code===b&&(c=d.name)})):null!=a.types&&0<a.types.length&&(a=a.types.filter(d=>d.id===b),0<a.length&&(c=a[0].name));return c}_checkDomain(a,b,c){let d=c;a=a.filter(e=>e.name.toLowerCase()===b.toLowerCase());0<a.length&&a[0].domain instanceof
E&&a[0].domain?.codedValues&&(a=a[0].domain.codedValues.filter(({code:e})=>e===c),0<a.length&&(d=a[0].name));return d}_checkParentForData(a,b){return a.parent?.[b]??null}_defaultDisplayField(a,b){return a.trim()?a:b.templates&&0<b.templates?.length?b.templates[0].name:b.title}_groupBy(a,b){return a.reduce((c,d)=>{(c[d[b]]=c[d[b]]||[]).push(d);return c},{})}_groupResultsByNetworkSource(a){return 0<a.length?this._groupBy(a,"networkSourceId"):[]}async _lookupFlagByHit(a){if(null==a.mapPoint)return[];
var b=await this.view.hitTest(a.screenPoint,{include:this._validUNLayers});const c=[];if(0<b.results.length&&(b=b.results.find(e=>null!==e.layer),null!=b.graphic?.geometry))if("polyline"===b.graphic.geometry.type){a=this._geometryHandler.getPercentageAlong(b.graphic.geometry,a.mapPoint,b.graphic.geometry.spatialReference);var d=this._getDisplayField(b.graphic);b.graphic.terminalId=null;b.graphic.isFilterBarrier=!1;b.graphic.allTerminals=null;b.graphic.selectedTerminals=null;b.graphic.percentAlong=
a;b.graphic.displayValue=d;b.graphic.mapPoint=b.mapPoint;c.push(b)}else"point"!==b.graphic.geometry.type&&"polygon"!==b.graphic.geometry.type||null===this.utilityNetwork||(a=this.utilityNetwork.getTerminalConfiguration(b.graphic),d=this._getDisplayField(b.graphic),b.graphic.terminalId=a?a.terminals[0].id||null:1,b.graphic.isFilterBarrier=!1,b.graphic.allTerminals=a??null,b.graphic.selectedTerminals=[a?a.terminals[0].id||null:1],b.graphic.percentAlong=null,b.graphic.displayValue=d,b.graphic.mapPoint=
b.mapPoint,c.push(b));return c}async _populateOutfields(){const a=this.view?.map,b=this.getValidSources();a?.layers.forEach(c=>{"group"===c.type?c.layers.forEach(d=>{b.some(e=>e.layerId===d.layerId)&&d.fields.some(e=>"assetgroup"===e.name.toLowerCase())&&(d.outFields=["assetgroup","assettype","globalid","objectid"])}):b.some(d=>d.layerId===c.layerId)&&c.fields.some(d=>"assetgroup"===d.name.toLowerCase())&&(c.outFields=["assetgroup","assettype","globalid","objectid"])})}_removeGraphic(a){this._getGraphicLayer(n)?.remove(a.mapGraphic)}_createGraphicLayer(a){const {map:b}=
this.view;b.findLayerById(a)||(a=new D({title:a,listMode:"hide",id:a}),b.add(a))}_getGraphicLayer(a){const {map:b}=this.view;return b&&(a=b.findLayerById(a))&&"graphics"===a.type?a:null}};k.__decorate([l.property()],h.prototype,"_activeProgress",void 0);k.__decorate([l.property()],h.prototype,"_flags",void 0);k.__decorate([l.property()],h.prototype,"_traces",void 0);k.__decorate([l.property()],h.prototype,"defaultGraphicColor",void 0);k.__decorate([l.property()],h.prototype,"enableResultArea",void 0);
k.__decorate([l.property()],h.prototype,"flags",void 0);k.__decorate([l.property()],h.prototype,"gdbVersion",void 0);k.__decorate([l.property()],h.prototype,"messages",void 0);k.__decorate([l.property()],h.prototype,"messagesUnits",void 0);k.__decorate([l.property()],h.prototype,"resultAreaProperties",null);k.__decorate([l.property()],h.prototype,"selectedTraces",void 0);k.__decorate([l.property()],h.prototype,"selectOnComplete",void 0);k.__decorate([l.property()],h.prototype,"showGraphicsOnComplete",
void 0);k.__decorate([l.property()],h.prototype,"showSelectionAttributes",void 0);k.__decorate([l.property({readOnly:!0})],h.prototype,"state",null);k.__decorate([l.property()],h.prototype,"traceResults",void 0);k.__decorate([l.property()],h.prototype,"utilityNetwork",void 0);k.__decorate([l.property({value:null})],h.prototype,"view",null);return h=k.__decorate([A.subclass("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceViewModel")],h)});