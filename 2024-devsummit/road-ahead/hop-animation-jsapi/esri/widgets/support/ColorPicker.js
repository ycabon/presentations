// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require exports ../../chunks/tslib.es6 ../../Color ../../core/asyncUtils ../../core/handleUtils ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/scheduling ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../Widget ../../chunks/componentsUtils ./Popover ./widgetUtils ./decorators/messageBundle ./jsxFactory".split(" "),function(k,c,d,l,q,m,r,n,p,t,e,A,B,C,u,v,w,x,D,
y,f){function z(a,b){const g=setTimeout(a,b);return m.makeHandle(()=>clearTimeout(g))}var h;(function(a){a.ColorPickerFocus="hex-input-poll-timeout";a.ButtonFocusTimeout="button-focus-timeout"})(h||={});c.ColorPicker=class extends v{constructor(a,b){super(a,b);this.value=new l;this.alphaEnabled=!0;this._buttonElement=this._popoverElement=this._popover=this._containerElement=null;this._colorPickerCreated=!1}initialize(){this.addHandles(p.watch(()=>({container:this._containerElement,value:this.value}),
({container:a,value:b})=>{a?.style.setProperty("--esri-color-picker-value",b.toCss(!0))},p.syncAndInitial))}loadDependencies(){return w.loadCalciteComponents({button:()=>new Promise((a,b)=>k(["../../chunks/calcite-button"],a,b)),"color-picker":()=>new Promise((a,b)=>k(["../../chunks/calcite-color-picker"],a,b)),label:()=>new Promise((a,b)=>k(["../../chunks/calcite-label"],a,b)),slider:()=>new Promise((a,b)=>k(["../../chunks/calcite-slider"],a,b))})}destroy(){this._destroyPopover();this._buttonElement=
null}render(){var a=this._messages;a=null!=this._popover&&this._popover.open?a.close:a.open;return f.tsx("div",{afterCreate:this._onContainerAfterCreate,bind:this,class:this.classes("esri-color-picker",this.class)},f.tsx("div",{class:"esri-color-picker__bg-pattern"}),f.tsx("calcite-button",{afterCreate:this._onButtonAfterCreate,appearance:"transparent",bind:this,class:"esri-color-picker__toggle-button",id:this.id,kind:"neutral",label:a,onclick:this._togglePopover,scale:"s",tabIndex:-1,title:a}))}_onContainerAfterCreate(a){this._containerElement=
a}_onButtonAfterCreate(a){this._destroyPopover();this._buttonElement=a;this._popover=new x({owner:this,anchorElement:a,placement:"bottom-start",renderContentFunction:this._renderPopoverContent})}_destroyPopover(){this.removeHandles(h.ColorPickerFocus);this._popover=r.destroyMaybe(this._popover);this._popoverElement=null}_renderPopoverContent(){const a=this.value,b=this._messages;return f.tsx("div",{afterCreate:this._onPopoverAfterCreate,bind:this,class:"esri-color-picker__popover",onfocusout:this._onPopoverFocusOut,
onkeydown:this._onPopoverKeyDown,tabIndex:-1},f.tsx("calcite-color-picker",{afterCreate:this._onColorPickerAfterCreate,afterRemoved:()=>this._colorPickerCreated=!1,bind:this,class:"esri-color-picker__calcite-color-picker",hideChannels:!0,hideSaved:!0,scale:"m",value:this._colorPickerCreated?a.toCss():null,onCalciteColorPickerInput:this._onColorInput}),this.alphaEnabled?f.tsx("section",{class:"esri-color-picker__opacity-slider-container"},f.tsx("calcite-label",{scale:"s"},b.opacity,f.tsx("calcite-slider",
{bind:this,class:"esri-color-picker__opacity-slider",labelHandles:!0,max:1,min:0,step:.01,value:a.a,onCalciteSliderInput:this._onOpacityChange}))):null)}_onColorInput(a){a=a.target.value;a="string"===typeof a?new l(a):new l;a.a=this.value.a;this._onChange(a)}_onOpacityChange(a){const b=this.value.clone();b.a=a.target.value;this._onChange(b)}_onChange(a){this.value=a;if(null!=this.onChange)this.onChange(a)}_onColorPickerAfterCreate(a){this.removeHandles(h.ColorPickerFocus);const b=q.createTask(async g=>
{a.componentOnReady&&await a.componentOnReady();n.throwIfAborted(g);this._colorPickerCreated=!0;await t.waitAnimationFrame();n.throwIfAborted(g);a.setFocus()});this.addHandles(m.makeHandle(()=>{b.abort();this._colorPickerCreated=!1}),h.ColorPickerFocus)}_togglePopover(a){null!=this._popover&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){const a=this._popover;a&&(a.open=!0)}_closePopover(){this.removeHandles(h.ColorPickerFocus);const a=this._popover;a&&(a.open=!1);this._setFocusOnButton()}_setFocusOnButton(){this.removeHandles(h.ButtonFocusTimeout);
this.addHandles(z(()=>this._buttonElement?.setFocus()),h.ButtonFocusTimeout)}_onPopoverAfterCreate(a){this._popoverElement=a}_onPopoverFocusOut(a){const b=this._popoverElement;null!=b&&((a=a.relatedTarget)&&a instanceof Node&&(b.contains(a)||a===this._buttonElement||this._isAssociatedLabel(a))||this._closePopover())}_isAssociatedLabel(a){const b=this.id,g=a.tagName?.toLowerCase();return"calcite-label"===g&&a.for===b||"label"===g&&a.htmlFor===b}_onPopoverKeyDown(a){if("Escape"===a.key||"Enter"===a.key)a.stopPropagation(),
this._closePopover()}};d.__decorate([e.property()],c.ColorPicker.prototype,"class",void 0);d.__decorate([e.property()],c.ColorPicker.prototype,"value",void 0);d.__decorate([e.property()],c.ColorPicker.prototype,"alphaEnabled",void 0);d.__decorate([e.property()],c.ColorPicker.prototype,"onChange",void 0);d.__decorate([e.property()],c.ColorPicker.prototype,"_containerElement",void 0);d.__decorate([e.property()],c.ColorPicker.prototype,"_popover",void 0);d.__decorate([e.property()],c.ColorPicker.prototype,
"_popoverElement",void 0);d.__decorate([e.property()],c.ColorPicker.prototype,"_buttonElement",void 0);d.__decorate([e.property(),y.messageBundle("esri/widgets/support/t9n/ColorPicker")],c.ColorPicker.prototype,"_messages",void 0);d.__decorate([e.property()],c.ColorPicker.prototype,"_colorPickerCreated",void 0);c.ColorPicker=d.__decorate([u.subclass("esri.widgets.support.ColorPicker")],c.ColorPicker);Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});