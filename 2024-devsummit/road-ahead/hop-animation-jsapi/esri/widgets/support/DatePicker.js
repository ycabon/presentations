// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../intl ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../Widget ./datePickerUtils ./DatePickerViewModel ./globalCss ./legacyIcon ./Popover ./decorators/accessibleHandler ./decorators/messageBundle ./jsxFactory ./widgetUtils ../../chunks/datetime ../../intl/date ../../intl/locale".split(" "),function(k,g,F,y,l,M,N,G,H,v,z,p,u,I,w,J,e,n,q,m,
x){const K=new Set(" ;ArrowDown;ArrowLeft;ArrowRight;ArrowUp;End;Enter;Home;PageDown;PageUp".split(";"));g=class extends H{constructor(a,b){super(a,b);this._rootNode=this._inputOrButtonNode=this._calendarNode=null;this._requestDayPickerFocusOnCreate=!1;this._activeDate=null;this._calendarPopover=new I({owner:this,placement:"bottom-start",anchorElement:()=>this._rootNode,renderContentFunction:this._renderCalendar});this.dateInputEnabled=this._isOpen=!1;this.messages=null;this.commitOnMonthChange=!1;
this.viewModel=new z;this.disabled=!1;this.timeZone=void 0;this.toggle=this.toggle.bind(this)}initialize(){this.addHandles(y.watch(()=>({viewModel:this.viewModel,value:this.viewModel?.value}),({viewModel:a,value:b})=>{if(!this.destroyed&&a&&null!=this.onChange)this.onChange(b)},y.sync))}destroy(){this._calendarPopover.destroy()}get _dateTimeFormatOptions(){return{year:"numeric",month:"2-digit",day:"2-digit",timeZone:this.timeZone||void 0}}get value(){return this.viewModel.value}set value(a){this.viewModel.value=
a}get isOpen(){return this._isOpen}render(){return e.tsx("div",{afterCreate:n.storeNode,bind:this,class:this.classes("esri-date-picker",p.globalCss.widget),"data-node-ref":"_rootNode"},this.dateInputEnabled?this._renderInputAndButtonMode():this._renderButtonOnlyMode())}toggle(){this._isOpen?this.close():this.open()}open(a=!0){this._activeDate=q.DateTime.fromJSDate(this.viewModel.value);this._isOpen=!0;this._calendarPopover.open=!0;this._requestDayPickerFocusOnCreate=a}close(a=!0){this._activeDate=
null;this._isOpen=!1;this._calendarPopover.open=!1;a&&this._inputOrButtonNode?.focus()}_renderButtonOnlyMode(){const a=m.formatDate(this.viewModel.value,this._dateTimeFormatOptions),{disabled:b,_isOpen:f,messages:h}=this;return e.tsx("div",{afterCreate:n.storeNode,"aria-controls":f?this._getCalendarId():null,"aria-expanded":f.toString(),"aria-haspopup":"true","aria-label":h.setDate,"aria-pressed":f.toString(),bind:this,class:this.classes(p.globalCss.widgetButton,p.globalCss.select,"esri-date-picker__calendar-toggle"),
"data-node-ref":"_inputOrButtonNode",key:`date-button-${b}`,onclick:this.toggle,onkeydown:this._handleDateButtonKeyDown,role:"button",tabIndex:b?void 0:0},e.tsx("span",{class:"esri-date-picker__date"},a))}_renderInputAndButtonMode(){const a=m.formatDate(this.viewModel.value,this._dateTimeFormatOptions),{_isOpen:b,messages:f}=this;return e.tsx("div",{class:this.classes("esri-date-picker__input")},e.tsx("input",{afterCreate:n.storeNode,"aria-controls":b?this._getCalendarId():null,"aria-haspopup":"true",
"aria-label":f.setDate,bind:this,class:this.classes("esri-date-picker__text-input",p.globalCss.input),"data-node-ref":"_inputOrButtonNode",key:"date-input",onblur:this._handleDateInputBlur,onclick:this._handleDateInputClick,onkeydown:this._handleDateInputKeyDown,type:"text",value:a}),e.tsx("span",{"aria-hidden":"true",class:this.classes("esri-date-picker__icon--leading",u.legacyIcon.calendar)}))}_handleDateInputClick(){this.open(!1)}_handleDateInputKeyDown(a){const {key:b}=a;this._isOpen?"Enter"===
b?this._handleDateText(a):"Escape"===b&&this.close():"ArrowDown"===b&&(this.open(),a.preventDefault())}_handleDateButtonKeyDown(a){const {key:b,shiftKey:f}=a;this._isOpen&&"Tab"===b&&f?this.close():n.isActivationKey(b)&&this.toggle()}_handleDateInputBlur(a){this._isOpen||this._handleDateText(a)}_handleDateText(a){a=a.currentTarget;try{var b=v.parseDateIntoParts(a.value,this._dateTimeFormatOptions)}catch(f){F.getLogger(this).warn(f);a.value=m.formatDate(this.viewModel.value,this._dateTimeFormatOptions);
return}b=q.DateTime.fromObject(b);b.isValid?(this.viewModel.value=b.toJSDate(),this._activeDate=b):a.value=m.formatDate(this.viewModel.value,this._dateTimeFormatOptions)}_handleDatePickerKeydown(a){const {key:b}=a;"Escape"===b&&(this.close(),a.preventDefault(),a.stopPropagation())}_renderCalendar(){const a=this._activeDate;if(!a)return null;const b=q.DateTime.fromJSDate(this.viewModel.value);return e.tsx("div",{afterCreate:n.storeNode,bind:this,class:this.classes("esri-date-picker__calendar",p.globalCss.widget),
"data-node-ref":"_calendarNode",id:this._getCalendarId(),key:"esri-date-picker__calendar",onfocusout:this._onCalendarFocusOut,onkeydown:this._handleDatePickerKeydown,tabIndex:-1},this._renderMonthPicker(a),this._renderDayPicker(a,b),this._renderYearPicker(a))}_getCalendarId(){return`date-picker__calendar--${this.id}`}_onCalendarFocusOut(a){(a=a.relatedTarget)&&a instanceof Node&&(this._calendarNode?.contains(a)||this._rootNode?.contains(a))||this.close(!1)}_renderMonthPicker(a){var b=n.isRTL(this.container);
const f=b?u.legacyIcon.right:u.legacyIcon.left;b=b?u.legacyIcon.left:u.legacyIcon.right;const h=q.Info.months("long",{locale:x.getLocale()}).map((r,t)=>e.tsx("option",{selected:a.month-1===t,value:t.toString()},r)),{disabled:c,messages:d}=this;return e.tsx("div",{class:"esri-date-picker__month-picker"},e.tsx("div",{"aria-label":d.goToPreviousMonth,bind:this,class:p.globalCss.button,key:`previous-month-${c}`,onclick:this._setPreviousMonth,onkeydown:this._handlePreviousMonthKeyDown,role:"button",tabIndex:c?
void 0:0,title:d.goToPreviousMonth},e.tsx("span",{"aria-hidden":"true",class:f})),e.tsx("select",{"aria-label":d.selectMonth,"aria-live":"assertive",bind:this,class:this.classes("esri-date-picker__month-dropdown",p.globalCss.select),disabled:c,id:`${this.id}__month-picker`,onchange:this._setMonth,onkeydown:this._setMonth,title:d.selectMonth},h),e.tsx("div",{"aria-label":d.goToNextMonth,bind:this,class:p.globalCss.button,key:`next-month-${c}`,onclick:this._setNextMonth,onkeydown:this._setNextMonth,
role:"button",tabIndex:c?void 0:0,title:d.goToNextMonth},e.tsx("span",{"aria-hidden":"true",class:b})))}_renderDayPicker(a,b){const f=this._getWeekLabels(),h=this._getDayId(a);a=this._renderMonth(a,b);const {id:c,disabled:d}=this;return e.tsx("div",{afterCreate:this._handleDayPickerCreate,"aria-activedescendant":h,"aria-labelledby":`${c}__month-picker ${c}__selected-year`,bind:this,class:"esri-date-picker__day-picker",id:`${c}__day-picker`,key:`day-picker-${d}`,onkeydown:this._handleDayPickerKeydown,
role:"grid",tabIndex:d?void 0:0},e.tsx("div",{class:"esri-date-picker__week-item",role:"row"},f.map(r=>e.tsx("div",{"aria-label":r.name,class:this.classes("esri-date-picker__day-item","esri-date-picker__day-item--header"),role:"columnheader",title:r.name},r.abbr))),a)}_getDayId(a){return`${this.id}__${m.formatDate(a.valueOf(),this._dateTimeFormatOptions)}`}_handleDayPickerCreate(a){this._requestDayPickerFocusOnCreate&&(this._requestDayPickerFocusOnCreate=!1,a.focus())}_getWeekLabels(){const a=[],
b={weekday:"long"},f={weekday:"narrow"};let h=q.DateTime.now().set({weekday:v.getFirstDayOfWeek(x.getLocale())});for(let c=0;7>c;c++)a.push({name:m.formatDate(h.valueOf(),b),abbr:m.formatDate(h.valueOf(),f)}),h=h.plus({day:1});return a}_handleDayPickerKeydown(a){const {key:b,ctrlKey:f,shiftKey:h}=a;if(K.has(b)){var c=this._activeDate;c&&("ArrowLeft"===b?c=c.minus({day:1}):"ArrowRight"===b?c=c.plus({day:1}):"ArrowUp"===b?c=c.minus({week:1}):"ArrowDown"===b?c=c.plus({week:1}):"PageUp"===b?c=c.minus({[h?
"year":"month"]:1}):"PageDown"===b?c=c.plus({[h?"year":"month"]:1}):"Home"===b?c=c.startOf(f?"year":"month"):"End"===b?c=c.endOf(f?"year":"month"):n.isActivationKey(b)&&(this.viewModel.value=c.toJSDate(),this.close()),this._activeDate=c,a.preventDefault(),a.stopPropagation())}}_renderMonth(a,b){const f=q.DateTime.now(),h=a.startOf("month"),c=a.endOf("month");let d=h.minus({day:v.getLocaleDayOfWeek(x.getLocale(),h.weekday)});const r=[];for(let A=0;6>A;A++){const B=[];for(let C=0;7>C;C++){const D=d.day,
E=d.hasSame(a,"day");var t=d.hasSame(b,"day");const L=this._getDayId(d);t={["esri-date-picker__day-item--nearby-month"]:!q.Interval.fromDateTimes(h,c).contains(d),["esri-date-picker__day-item--today"]:d.hasSame(f,"day"),["esri-date-picker__day-item--active"]:E,["esri-date-picker__day-item--selected"]:t};B.push(e.tsx("div",{"aria-label":D.toString(),"aria-selected":E.toString(),bind:this,class:this.classes("esri-date-picker__day-item",t),"data-iso-date":d.toISO(),id:L,onclick:this._handleSelectedDate,
onkeydown:this._handleSelectedDate,role:"gridcell"},D));d=d.plus({day:1})}r.push(e.tsx("div",{class:"esri-date-picker__week-item",role:"row"},B))}return r}_renderYearPicker(a){const b={year:"numeric"},f=m.formatDate(a.valueOf(),b),h=m.formatDate(a.plus({year:1}).valueOf(),b);a=m.formatDate(a.minus({year:1}).valueOf(),b);const {disabled:c,messages:d}=this;return e.tsx("div",{class:"esri-date-picker__year-picker"},e.tsx("div",{"aria-label":d.goToPreviousYear,bind:this,class:"esri-date-picker__year-picker-item",
key:`previous-year-${c}`,onclick:this._setPreviousYear,onkeydown:this._setPreviousYear,tabIndex:c?void 0:0,title:d.goToPreviousYear},a),e.tsx("div",{class:this.classes("esri-date-picker__year-picker-item","esri-date-picker__year-picker-item--selected"),id:`${this.id}__selected-year`},f),e.tsx("div",{"aria-label":d.goToNextYear,bind:this,class:"esri-date-picker__year-picker-item",key:`next-year-${c}`,onclick:this._setNextYear,onkeydown:this._handleNextYearKeyDown,tabIndex:c?void 0:0,title:d.goToNextYear},
h))}_setMonth(a){this._activeDate&&(this._activeDate=this._activeDate.set({month:Number(a.target.value)+1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate()))}_setPreviousMonth(){this._activeDate&&(this._activeDate=this._activeDate.minus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate()))}_handlePreviousMonthKeyDown(a){"Tab"===a.key&&a.shiftKey?(a.preventDefault(),this.close()):n.isActivationKey(a.key)&&this._setPreviousMonth()}_setNextMonth(){this._activeDate&&
(this._activeDate=this._activeDate.plus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate()))}_setPreviousYear(){this._activeDate=this._activeDate?.minus({year:1})??null}_setNextYear(){this._activeDate=this._activeDate?.plus({year:1})??null}_handleNextYearKeyDown(a){"Tab"!==a.key||a.shiftKey?n.isActivationKey(a.key)&&this._setNextYear():(a.preventDefault(),this.close())}_handleSelectedDate(a){this.viewModel.value=q.DateTime.fromISO(a.target.getAttribute("data-iso-date")).toJSDate();
this.close()}};k.__decorate([l.property()],g.prototype,"_activeDate",void 0);k.__decorate([l.property()],g.prototype,"_calendarPopover",void 0);k.__decorate([l.property()],g.prototype,"_isOpen",void 0);k.__decorate([l.property()],g.prototype,"_dateTimeFormatOptions",null);k.__decorate([l.property()],g.prototype,"dateInputEnabled",void 0);k.__decorate([l.property(),J.messageBundle("esri/widgets/support/t9n/DatePicker")],g.prototype,"messages",void 0);k.__decorate([l.property()],g.prototype,"value",
null);k.__decorate([l.property()],g.prototype,"commitOnMonthChange",void 0);k.__decorate([l.property({type:z})],g.prototype,"viewModel",void 0);k.__decorate([l.property()],g.prototype,"onChange",void 0);k.__decorate([l.property()],g.prototype,"disabled",void 0);k.__decorate([l.property()],g.prototype,"timeZone",void 0);k.__decorate([l.property()],g.prototype,"isOpen",null);k.__decorate([w.accessibleHandler()],g.prototype,"_setNextMonth",null);k.__decorate([w.accessibleHandler()],g.prototype,"_setPreviousYear",
null);k.__decorate([w.accessibleHandler()],g.prototype,"_handleSelectedDate",null);return g=k.__decorate([G.subclass("esri.widgets.support.DatePicker")],g)});