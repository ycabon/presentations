// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../geometry ../../../core/asyncUtils ../../../core/Collection ../../../core/Evented ../../../core/handleUtils ../../../core/promiseUtils ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/coordsUtils ../../../views/draw/DrawScreenTool ../../../views/interactive/keybindings ./selectorUtils ../../../geometry/Point ../../../geometry/Polygon".split(" "),
function(g,e,u,v,w,x,p,y,l,F,G,H,z,A,B,m,C,D,E){e=class extends w.EventedAccessor{constructor(c){super(c);this.options=this._processTask=null;this.selection=new v;this.sources=null;this._process=p.debounce(async(b,a)=>{const {callback:d,selector:f,completed:h}=b,k=u.createTask(async q=>{const {sources:r,selection:t,view:n}=this;(r?.length||n?.selectionManager.sources.length)&&n?(f&&null!=r&&(q=await C.getSelectionFromGeometry({currentSelection:t,sources:r,selector:f,signal:q,view:n}),h&&n.selectionManager?.updateSelection({current:t.toArray(),
...q})),d&&d()):t.removeAll()});p.onAbort(a,()=>k.abort());this._processTask=k;return k.promise},100)}initialize(){this._setup()}cancel(){this.removeAllHandles();this._processTask?.abort()}async _setup(){const {view:c}=this;await c.whenReady();if(!this.destroyed){var b=this.options?.createTool??"rectangle";this._tool=new B.DrawScreenTool({view:c,mode:this.options?.mode??("polygon"===b?"click":"hybrid"),geometryType:b});this.addHandles([this.view.on("key-down",a=>{if(!a.repeat)switch(a.key){case m.sketchKeys.constraint:this._tool.uniformSizeToggled=
!0;a.stopPropagation();break;case m.sketchKeys.center:this._tool.centeredToggled=!0,a.stopPropagation()}}),this.view.on("key-up",a=>{switch(a.key){case m.sketchKeys.constraint:this._tool.uniformSizeToggled=!1;a.stopPropagation();break;case m.sketchKeys.center:this._tool.centeredToggled=!1,a.stopPropagation()}}),this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>p.ignoreAbortErrors(this._process({selector:this._selectionArea}))),this._tool.on("complete",async a=>{const d=()=>{this.removeAllHandles();
this.emit("complete",{aborted:a.aborted,selection:this.selection.toArray()})};a.aborted?(this._processTask?.abort(),this.selection.removeAll(),d()):await this._process({selector:this._selectionArea,callback:d,completed:!0})})]);this.addHandles(x.makeHandle(()=>this.view.tools.remove(this._tool)));this.view.addAndActivateTool(this._tool)}}get _selectionArea(){const c=y.createScreenPoint();var b=this._tool.coordinates;const a=this.view.spatialReference,d=f=>{c.x=f[0];c.y=f[1];const {x:h,y:k}=this.view.toMap(c);
return[h,k]};if(1===b.length){const [f,h]=d(b[0]);return new D({x:f,y:h,spatialReference:a})}b=this._tool.coordinates.map(d);if(0!==b.length)return A.isClockwise(b)||b.reverse(),new E({spatialReference:a,rings:[b]})}};g.__decorate([l.property()],e.prototype,"options",void 0);g.__decorate([l.property({readOnly:!0})],e.prototype,"selection",void 0);g.__decorate([l.property()],e.prototype,"sources",void 0);g.__decorate([l.property({constructOnly:!0})],e.prototype,"view",void 0);return e=g.__decorate([z.subclass("esri.widgets.support.Selector2D.SelectionOperation2D")],
e)});